<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.14.1 by Michael Rose
  Copyright 2013-2018 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Spring Cloud Configuration - Part 2 | Tech Stack Java</title>
<meta name="description" content="In Part 1 we created git repository and config server. In this article we will create a pet-store application which is also a client for the configuration server, because pet-store will request application properties from config server.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Tech Stack Java">
<meta property="og:title" content="Spring Cloud Configuration - Part 2">
<meta property="og:url" content="http://localhost:4000/techstackjava/blog/2018/07/11/spring-cloud-config-basics-part-2">


  <meta property="og:description" content="In Part 1 we created git repository and config server. In this article we will create a pet-store application which is also a client for the configuration server, because pet-store will request application properties from config server.">



  <meta property="og:image" content="http://localhost:4000/techstackjava/assets/images/banners/spring-cloud-config-basics-part-2.png">





  <meta property="article:published_time" content="2018-07-11T13:11:10-04:00">






<link rel="canonical" href="http://localhost:4000/techstackjava/blog/2018/07/11/spring-cloud-config-basics-part-2">







  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Pradeep Kundarapu",
      "url": "http://localhost:4000/techstackjava",
      "sameAs": ["https://twitter.com/PradeepK4J","https://www.linkedin.com/in/pradeepkundarapu"]
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/techstackjava/feed.xml" type="application/atom+xml" rel="alternate" title="Tech Stack Java Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/techstackjava/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="/techstackjava/">Tech Stack Java</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/techstackjava/about/" >About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  

  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Spring Cloud Configuration - Part 2">
    <meta itemprop="description" content="In Part 1 we created git repository and config server. In this article we will create a pet-store application which is also a client for the configuration server, because pet-store will request application properties from config server.">
    <meta itemprop="datePublished" content="July 11, 2018">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Spring Cloud Configuration - Part 2
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read
</p>
          
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        
        
            <img src="/assets/images/banners/spring-cloud-config-basics-part-2.png" style="margin: 1em 0">
        

        <p>In <strong><a href="/blog/2018/06/27/spring-cloud-config-basics-part-1.html">Part 1</a></strong> we created git repository and config server. In this article we will create a pet-store application which is also a client for the configuration server, because pet-store will request application properties from config server.</p>

<h2 id="create-configuration-client">Create Configuration Client</h2>

<p>Go to <strong><a href="https://start.spring.io/">start.spring.io</a></strong> to generate spring project with <em>web</em>, <strong>config-client</strong> and <em>actuator</em> as dependencies, see below image for reference.</p>

<p><img src="/assets/images/posts/2018/07/pet-store-config-client.png" alt="pet store config client" height="500px" width="650px" class="align-center" /></p>

<p>Unzip and open the project in any IDE. We are going to configure pet-store app to load properties from config server so we no more need application.properties located at src/main/resources folder.</p>

<p>In-order for pet-store app to load properties from config server it needs config server connection details, because with out server machine name and port, pet-store can not connect to it. We can use bootstrap.properties to provide these details. Spring will load bootstrap.properties if it is available. bootstrap properties file should be used for only properties which are needed at application startup time, in our case we need server connection details so pet-store will use these details to connect and get properties from server at startup time.</p>

<p>Rename application.properties to bootstrap.properties and add below three properties in it.</p>

<p>File: bootstrap.properties</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">spring.application.name <span class="o">=</span> pet-store // &lt;1&gt;
spring.profiles.active <span class="o">=</span> dev // &lt;2&gt;
spring.cloud.config.uri <span class="o">=</span> http://localhost:8888 // &lt;3&gt;</code></pre></figure>

<p>Above three properties are needed for config client to connect server.</p>

<p>&lt;1&gt; In a microservices environment multiple applications work together and this property will allow us to provide unique name for each application.<br />
&lt;2&gt; Multiple instances of an application can exist like; dev, uat or prod so each of them are profiled with this property.<br />
&lt;3&gt; Client will make HTTP call using this URL to get properties from config server.</p>

<p>Using all of the above properties client will construct the URL and it looks like this; <strong>http://localhost:8888/pet-store/dev</strong> this URL contains all of the above mentioned three properties; config url, application name and profile.</p>

<p>To verify if everything is working, we can create a REST end point which will return <em>message</em> property as response. Note that in <strong><a href="/blog/2018/06/27/spring-cloud-config-basics-part-1.html">Part 1</a></strong> we added <strong>message</strong> property in <strong>pet-store-dev.properties</strong>. Config client will use above three properties to request properties from the server on startup and client gets <em>message</em> as part of the response from server.</p>

<p>Below is the REST controller which returns message;</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@RestController</span>
<span class="kd">class</span> <span class="nc">MessageController</span><span class="o">{</span>
	<span class="nd">@Value</span><span class="o">(</span><span class="s">"${message}"</span><span class="o">)</span>
	<span class="n">String</span> <span class="n">message</span><span class="o">;</span>

	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/message"</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getMessage</span><span class="o">(){</span>
		<span class="k">return</span> <span class="n">message</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>Start pet-store application and in the browser open <em>http://localhost:8080/message</em> to get <em>Hello!</em> as response.</p>

<p><img src="/assets/images/posts/2018/07/pet-store-hello.png" alt="pet store hello" height="150px" width="500px" class="align-center" /></p>

<h2 id="update-properties">Update properties</h2>

<p>In your local perform a small test; change <em>message</em> property in <em>pet-store-dev.properties</em> and save, then open <strong>http://localhost:8080/message</strong> it will not show updated property instead it returns old value. This is because changes to the property files are not automatically propagated to the clients. On the client side we need to manually trigger a refresh event which will request fresh copy again from the server and refreshes only the classes which are declared with <strong>@RefreshScope</strong> annotation.</p>

<p>In our case we update <strong>MessageController</strong> class to include <strong>@RefreshScope</strong> annotation so its <strong>message</strong> fields gets updated with new value.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@RestController</span>
<span class="nd">@RefreshScope</span>
<span class="kd">class</span> <span class="nc">MessageController</span><span class="o">{</span>
	<span class="nd">@Value</span><span class="o">(</span><span class="s">"${message}"</span><span class="o">)</span>
	<span class="n">String</span> <span class="n">message</span><span class="o">;</span>

	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/message"</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getMessage</span><span class="o">(){</span>
		<span class="k">return</span> <span class="n">message</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>Start pet-store application and open <strong>http://localhost:8080/message</strong> to see current value in the <strong>pet-store-dev.properties</strong> file. Lets update <strong>message</strong> in the properties file like below;</p>

<p>File: pet-store-dev.properties</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">message</span><span class="o">=</span>Hello World!
management.endpoints.web.exposure.include<span class="o">=</span>refresh</code></pre></figure>

<p>We will not see updated <strong>message</strong> value on <strong>http://localhost:8080/message</strong>. To get updated value we need to manually trigger refresh event. To trigger this event we need to make a HTTP POST request to pet-store client on <strong>/actuator/refresh</strong> end-point. I used <em>curl</em> command to make this request;</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">curl <span class="nt">-X</span> POST http://localhost:8080/actuator/refresh</code></pre></figure>

<p>This curl command will make a POST request, which will make client to again request the properties and these properties are only applied on the classes which are declared with <strong>@RefreshScope</strong> annotation.</p>

<p>Open <strong>http://localhost:8080/message</strong> to see <strong>Hello World!</strong></p>

<p><img src="/assets/images/posts/2018/07/pet-store-hello-world.png" alt="pet store hello world" height="150px" width="500px" class="align-center" /></p>

<h2 id="conclusion">Conclusion</h2>
<p>In this post we created a client application which depends on the config server to get properties and also used @RefreshScope annotation to update properties.</p>

        
      </section>

      <footer class="page__meta">
        
        


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2018-07-11T13:11:10-04:00">July 11, 2018</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Spring+Cloud+Configuration+-+Part+2%20http%3A%2F%2Flocalhost%3A4000%2Ftechstackjava%2Fblog%2F2018%2F07%2F11%2Fspring-cloud-config-basics-part-2" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Ftechstackjava%2Fblog%2F2018%2F07%2F11%2Fspring-cloud-config-basics-part-2" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=http%3A%2F%2Flocalhost%3A4000%2Ftechstackjava%2Fblog%2F2018%2F07%2F11%2Fspring-cloud-config-basics-part-2" class="btn btn--google-plus" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Google Plus"><i class="fab fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Ftechstackjava%2Fblog%2F2018%2F07%2F11%2Fspring-cloud-config-basics-part-2" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/techstackjava/blog/2018/06/27/spring-cloud-config-basics-part-1" class="pagination--pager" title="Spring Cloud Configuration - Part 1
">Previous</a>
    
    
      <a href="/techstackjava/blog/2018/07/22/pull-and-run-first-docker-image" class="pagination--pager" title="Pull And Run First Docker Image
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/techstackjava/assets/images/banners/reactiveX-observables.png"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/techstackjava/blog/2018/07/24/observables" rel="permalink">8 Quick Ways To Create Observables
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Many operators are available in RxJava to create observables. In this post I will go through each of them with examples. In the context of reactive programmi...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/techstackjava/assets/images/banners/pull-and-run-first-docker-image.png"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/techstackjava/blog/2018/07/22/pull-and-run-first-docker-image" rel="permalink">Pull And Run First Docker Image
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  5 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Docker image is a file, which contains set of commands. When these commands are executed, instance of the image is created and this instance is called Contai...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/techstackjava/assets/images/banners/spring-cloud-config-basics-part-1.png"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/techstackjava/blog/2018/06/27/spring-cloud-config-basics-part-1" rel="permalink">Spring Cloud Configuration - Part 1
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Configuration can be any key value pair information needed by the application at runtime. Spring applications accepts configuration in many ways like command...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/techstackjava/assets/images/banners/reactiveX-observables.png"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/techstackjava/blog/2018/06/15/reactivex-observables" rel="permalink">ReactiveX Observables
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  4 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Observable emit values over the time and the observer who is interested to receive those values should subscribe for it. On the availability of values observ...</p>
  </article>
</div>
        
      </div>
    </div>
  
  
</div>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><input type="text" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
    <div id="results" class="results"></div></div>
      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/PradeepK4J" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/kpradeep12" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/pradeepkundarapu/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
        
      
    

    <li><a href="/techstackjava/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2018 Pradeep Kundarapu. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/techstackjava/assets/js/main.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0" crossorigin="anonymous"></script>




<script src="/techstackjava/assets/js/lunr/lunr.min.js"></script>
<script src="/techstackjava/assets/js/lunr/lunr-store.js"></script>
<script src="/techstackjava/assets/js/lunr/lunr-en.js"></script>




    
  <script>
    var disqus_config = function () {
      this.page.url = "http://localhost:4000/techstackjava/blog/2018/07/11/spring-cloud-config-basics-part-2";  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = "/blog/2018/07/11/spring-cloud-config-basics-part-2"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://k_pradeep1234.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  



  </body>
</html>
