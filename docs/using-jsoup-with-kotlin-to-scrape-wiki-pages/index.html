<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="google-site-verification" content="17GXTKdnqGMgpkrc7Kbz323f4wg41DzBsDcNsfnHmVo" />
<!--below verification is techstackjava.com-->
<meta name="google-site-verification" content="tuMqCtGo9Q2zjZ6e2k1iswdB1R56vqiqYfbSrrzlyRE" />
<meta name="google-site-verification" content="6prhbit_zvr5fgjCg8h5zm8eH7tQrVeMcbHGOhb393g" />
<!-- Twitter cards-->
<meta name="twitter:site"    content="@PradeepK4J">
<meta name="twitter:creator" content="@pradeep">
<meta name="twitter:title"   content="Using Jsoup With Kotlin To Scrape Wiki Pages">

<meta name="twitter:card"  content="summary_large_image">
<meta name="twitter:image" content="http://thetechstack.net/assets/images/banners/scrape-wiki-pages-with-jsoup.jpg">

<!-- end of Twitter cards -->


<link rel="icon" href="/assets/images/logo.png">
    
<!--<title>Using Jsoup With Kotlin To Scrape Wiki Pages | The Tech Stack . Net</title>-->
    
<meta name="description" content="Wikipedia has huge number of pages dedicated to Movies and I created a small kotlin program which scrapes these Movie pages and extracts details like director, producer, cast and many more fields. In this article I will explain using Jsoup library with Kotlin language."> 
    
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
    
<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
    
<link href="/assets/css/screen.css" rel="stylesheet">
    
<link href="/assets/css/main.css" rel="stylesheet">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Using Jsoup With Kotlin To Scrape Wiki Pages | Pradeep’s Java and Kotlin blog</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Using Jsoup With Kotlin To Scrape Wiki Pages" />
<meta name="author" content="pradeep" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Wikipedia has huge number of pages dedicated to Movies and I created a small kotlin program which scrapes these Movie pages and extracts details like director, producer, cast and many more fields. In this article I will explain using Jsoup library with Kotlin language." />
<meta property="og:description" content="Wikipedia has huge number of pages dedicated to Movies and I created a small kotlin program which scrapes these Movie pages and extracts details like director, producer, cast and many more fields. In this article I will explain using Jsoup library with Kotlin language." />
<link rel="canonical" href="http://thetechstack.net/using-jsoup-with-kotlin-to-scrape-wiki-pages/" />
<meta property="og:url" content="http://thetechstack.net/using-jsoup-with-kotlin-to-scrape-wiki-pages/" />
<meta property="og:site_name" content="Pradeep’s Java and Kotlin blog" />
<meta property="og:image" content="http://thetechstack.net/assets/images/banners/scrape-wiki-pages-with-jsoup.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-03-13T21:11:10-04:00" />
<script type="application/ld+json">
{"image":"http://thetechstack.net/assets/images/banners/scrape-wiki-pages-with-jsoup.jpg","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://thetechstack.net/using-jsoup-with-kotlin-to-scrape-wiki-pages/"},"dateModified":"2019-03-13T21:11:10-04:00","url":"http://thetechstack.net/using-jsoup-with-kotlin-to-scrape-wiki-pages/","author":{"@type":"Person","name":"pradeep"},"headline":"Using Jsoup With Kotlin To Scrape Wiki Pages","description":"Wikipedia has huge number of pages dedicated to Movies and I created a small kotlin program which scrapes these Movie pages and extracts details like director, producer, cast and many more fields. In this article I will explain using Jsoup library with Kotlin language.","datePublished":"2019-03-13T21:11:10-04:00","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-115619272-1', 'auto');
  ga('send', 'pageview');
</script>


</head>
    


<body class="layout-post">

    
<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">
    
    <div class="container pr-0">    
    
    <!-- Begin Logo -->
    <a class="navbar-brand" href="/">
    <img src="/" alt="The Tech Stack . Net">
    </a>
    <!-- End Logo -->
  
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>
    
    
    <div class="collapse navbar-collapse" id="navbarMediumish">
       
        <!-- Begin Menu -->
        
            <ul class="navbar-nav ml-auto">
                <!--
                
                <li class="nav-item">
                
                <a class="nav-link" href="/index.html">Blog</a>
                </li>-->
                
                
                <li class="nav-item">
                
                <a class="nav-link" href="/about">About Me</a>
                </li>
                
                
                <li class="nav-item">
                
                <a class="nav-link" href="/twitter">Twitter</a>
                </li>
                <!--
                <li class="nav-item">
                <a target="_blank"  class="nav-link" href="https://twitter.com/PradeepK4J"><i class="fab fa-twitter"></i></a>
                </li>-->
                
            </ul>		
  
        <!-- End Menu -->

    </div>
        
    </div>
</nav>
<!-- End Navigation
================================================== -->
    
<div class="site-content">   
<div class="container">
    
<!-- Site Title
================================================== -->
<!--<div class="mainheading">
    <h1 class="sitetitle">The Tech Stack . Net</h1>
    <p class="lead">
         Sharing my Java and Kotlin coding experiments
    </p>
</div>-->

    
    
<!-- Content
================================================== --> 
<div class="main-content">
    <!-- Begin Article
================================================== -->
<div class="container">
	<div class="row">

		<!-- Post Share -->
		<div class="col-md-2 pl-0">            
           <div class="share">
    <p>
        Share
    </p>
    <ul>
        <li class="ml-1 mr-1">
        <a target="_blank" href="https://twitter.com/intent/tweet?text=Using Jsoup With Kotlin To Scrape Wiki Pages&url=http://thetechstack.net/using-jsoup-with-kotlin-to-scrape-wiki-pages/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <i class="fab fa-twitter"></i>
        </a>
        </li>
        
        <li class="ml-1 mr-1">
        <a target="_blank" href="https://facebook.com/sharer.php?u=http://thetechstack.net/using-jsoup-with-kotlin-to-scrape-wiki-pages/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
        <i class="fab fa-facebook-f"></i>
        </a>
        </li>
        
        <li class="ml-1 mr-1">
        <a target="_blank" href="https://plus.google.com/share?url=http://thetechstack.net/using-jsoup-with-kotlin-to-scrape-wiki-pages/" onclick="window.open(this.href, 'facebook-google', 'width=550,height=435');return false;">
        <i class="fab fa-google"></i>
        </a>
        </li>
        
    </ul>
    
    <div class="sep">
    </div>				
    <ul>
        <li> 
        <a  class="small smoothscroll" href="#disqus_thread"></a>
        </li>
    </ul>
    
</div>  
		</div>
		

		<!-- Post -->        
        
        
		<div class="col-md-9 flex-first flex-md-unordered">
			<div class="mainheading">

                <!-- Author Box -->
                				
				<div class="row post-top-meta">
					<div class="col-md-2">
						<img class="author-thumb" src="/assets/images/author.jpg" alt="Pradeep Kundarapu">
					</div>
					<div class="col-md-10">
                        <a target="_blank" class="link-dark" href="http://thetechstack.net">Pradeep Kundarapu</a>
                        <a target="_blank" href="https://twitter.com/PradeepK4J" class="btn follow">Follow</a>
						<div class="author-description">Java & Kotlin developer, blogger and tech enthusiast.</div>						
					</div>
				</div>				
                
                
                <!-- Post Title -->
				<h1 class="posttitle">Using Jsoup With Kotlin To Scrape Wiki Pages</h1> 
                
			</div>

			<!-- Post Featured Image -->
			<img class="featured-image img-fluid" src="http://thetechstack.net/assets/images/banners/scrape-wiki-pages-with-jsoup.jpg" alt="Using Jsoup With Kotlin To Scrape Wiki Pages">
			<!-- End Featured Image -->

			<!-- Post Content -->
			<div class="article-post">
				<p>In this article, I will explain using <strong><a href="https://jsoup.org/">Jsoup</a></strong> library with <strong>Kotlin</strong> language. <strong>Jsoup</strong> helps us to parse and extract data from HTML documents. Depending on the use-case we can use this library to scrape various HTML pages and extract required information.</p>

<blockquote>
  <p><strong><a href="https://jsoup.org/">Jsoup</a></strong> is a Java library for working on HTML pages. This library provides API for extracting and manipulating data.</p>
</blockquote>

<p>Wiki has huge number of pages dedicated to Movies and I created a small Kotlin program which scrapes these Movie pages. I will show the details and explain how I developed it in this article. My idea was to choose any Wiki page which contains list of movies and go through each movie from the list and scrape the data from that wiki page.</p>

<blockquote>
  <p>Here is the link of a wiki page which I worked on <a href="https://en.wikipedia.org/wiki/List_of_films_with_a_100%25_rating_on_Rotten_Tomatoes">List of films with a 100% rating on Rotten Tomatoes</a>. Below is the screenshot from Wiki page.</p>
</blockquote>

<p><img src="/assets/images/posts/2019/03/rotten-movie-list.jpg" alt="Rotten tomatoes movie list" height="400px" width="500px" class="align-center" /></p>

<p>This page contains list of 100% rated movies on Rotten Tomatoes. My code will go through each row in the table and for each row it performs below tasks;</p>

<ul>
  <li>Extracts first column from the row because it contains movie title and the URL. For example, first row in the table is <strong>The Cabinet of Dr. Caligari</strong> and its URL is <strong>https://en.wikipedia.org/wiki/The_Cabinet_of_Dr._Caligari</strong></li>
  <li>For each URL, loads the page and extracts its content into a <strong>Movie</strong> instance.</li>
</ul>

<p>Once all movie instances are created then we can insert them into a database with any <strong>ORM</strong> library, but in this article I am not going to perform any database operations.</p>

<p>Lets dive in to the details.</p>

<ul id="markdown-toc">
  <li><a href="#create-kotlin-project" id="markdown-toc-create-kotlin-project">Create Kotlin project</a></li>
  <li><a href="#add-jsoup" id="markdown-toc-add-jsoup">Add Jsoup</a></li>
  <li><a href="#scrape-html-page" id="markdown-toc-scrape-html-page">Scrape HTML Page</a>    <ul>
      <li><a href="#extract-movie-urls" id="markdown-toc-extract-movie-urls">Extract movie URL’s</a></li>
      <li><a href="#scrape-movie-page" id="markdown-toc-scrape-movie-page">Scrape movie page</a></li>
    </ul>
  </li>
  <li><a href="#parallel-vs-sequential-processing" id="markdown-toc-parallel-vs-sequential-processing">Parallel vs Sequential processing</a></li>
  <li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li>
</ul>

<blockquote>
  <p>Please note that this whole project is available in <a href="https://github.com/kpradeep12/techstack-projects/tree/master/wiki-scraper">github</a></p>
</blockquote>

<h3 id="create-kotlin-project">Create Kotlin project</h3>

<p>Execute below command to create an empty gradle Kotlin project. Once the project is created then import it into your favorite editor.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">mkdir </span>wiki-scraper
<span class="nb">cd </span>wiki-scraper
gradle init <span class="nt">--type</span> kotlin-application

Select build script DSL:
  1: groovy
  2: kotlin
Enter selection <span class="o">(</span>default: kotlin<span class="o">)</span> <span class="o">[</span>1..2] 

Project name <span class="o">(</span>default: wiki-scraper<span class="o">)</span>: 
Source package <span class="o">(</span>default: wiki.scraper<span class="o">)</span>: net.thetechstack</code></pre></figure>

<blockquote>
  <p>I executed this command on Gradle 5.2.1 version. You can choose to create kotlin project with any other build tool.</p>
</blockquote>

<p>This command will create a new project with standard folder structure and default <strong>App.kt</strong> file.</p>

<h3 id="add-jsoup">Add Jsoup</h3>

<p>Add below dependencies to your build.gradle</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">dependencies</span> <span class="o">{</span>
    <span class="c1">//..</span>
    <span class="n">implementation</span><span class="o">(</span><span class="s">"org.jsoup:jsoup:1.11.3"</span><span class="o">)</span>
<span class="o">}</span></code></pre></figure>

<p>Now we have our project with required dependencies. Let’s dive into the code.</p>

<h3 id="scrape-html-page">Scrape HTML Page</h3>

<p>First, we need to parse and extract URL’s of the movies from the table.</p>

<h4 id="extract-movie-urls">Extract movie URL’s</h4>

<p>Kotlin execution starts from <strong>main()</strong> function so lets update <strong>App.kt</strong> with below code.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">val</span> <span class="n">wiki</span> <span class="o">=</span> <span class="s">"https://en.wikipedia.org"</span>

<span class="n">fun</span> <span class="nf">main</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">val</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">Jsoup</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="s">"$wiki/wiki/List_of_films_with_a_100%25_rating_on_Rotten_Tomatoes"</span><span class="o">).</span><span class="na">get</span><span class="o">()</span>    <span class="c1">// &lt;1&gt;</span>
    <span class="n">doc</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">".wikitable:first-of-type tr td:first-of-type a"</span><span class="o">)</span>    <span class="c1">// &lt;2&gt;</span>
            <span class="o">.</span><span class="na">map</span> <span class="o">{</span> <span class="n">col</span> <span class="o">-&gt;</span> <span class="n">col</span><span class="o">.</span><span class="na">attr</span><span class="o">(</span><span class="s">"href"</span><span class="o">)</span> <span class="o">}</span>    <span class="c1">// &lt;3&gt;</span>
            <span class="o">.</span><span class="na">parallelStream</span><span class="o">()</span>    <span class="c1">// &lt;4&gt;</span>
            <span class="o">.</span><span class="na">map</span> <span class="o">{</span> <span class="n">extractMovieData</span><span class="o">(</span><span class="n">it</span><span class="o">)</span> <span class="o">}</span>    <span class="c1">// &lt;5&gt;</span>
            <span class="o">.</span><span class="na">filter</span> <span class="o">{</span> <span class="n">it</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">}</span>
            <span class="o">.</span><span class="na">forEach</span> <span class="o">{</span> <span class="n">println</span><span class="o">(</span><span class="n">it</span><span class="o">)</span> <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<ul>
  <li><strong>&lt;1&gt;</strong> <strong>Jsoup.connect(…)</strong> will connect to the URL and creates <strong>Connection</strong> object. Once the connection object is created then called <strong>get()</strong> on it so the page is parsed and returned as the Document object. We stored document in the <strong>doc</strong> variable.</li>
</ul>

<blockquote>
  <p>Open <a href="https://en.wikipedia.org/wiki/List_of_films_with_a_100%25_rating_on_Rotten_Tomatoes">https://en.wikipedia.org/wiki/List_of_films_with_a_100%25_rating_on_Rotten_Tomatoes</a> in a browser. This page contains a table with all 100% rated movies. We need to extract URL’s of these movies.</p>
</blockquote>

<p>Below screenshot shows the URL of the movie with browsers inspector window open.</p>

<p><img src="/assets/images/posts/2019/03/extract-movie-url.jpg" alt="Rotten tomatoes movie list" height="400px" width="600px" class="align-center" /></p>

<ul>
  <li><strong>&lt;2&gt;</strong> <strong>select</strong> takes a CSS query and returns all matched elements as <strong>Elements</strong> instance. <strong>Elements</strong> is a collection which extends <strong>ArrayList</strong> so we can iterate and process the elements individually. We passed <strong>.wikitable:first-of-type tr td:first-of-type a</strong>. This is a bit complex CSS query. Lets divide this into pieces to understand it;
    <ul>
      <li><strong>.wikitable:first-of-type</strong> Get first matched element which contains <strong>.wikitable</strong> class. If you inspect the page in the browser then you see the movies table contains <strong>.wikitable</strong> class.</li>
      <li><strong>.wikitable:first-of-type tr</strong> Extract all rows in the table.</li>
      <li><strong>.wikitable:first-of-type tr td:first-of-type</strong> but we are interested only on first column of the table because it contains the movie title with URL. So this extracts the first <strong>td</strong>.</li>
      <li><strong>.wikitable:first-of-type tr td:first-of-type a</strong> With in the first column we need anchor tag because this contains the URL for the movie page.</li>
    </ul>
  </li>
  <li><strong>&lt;3&gt;</strong> We need <strong>href</strong> attribute because it contains the URL so using map we convert <strong>Element</strong> to <strong>String</strong> which contains the URL.</li>
  <li><strong>&lt;4&gt;</strong> We have more than 300 movies in the table and for each movie we need to parse the movie page and extract its content so instead of doing it in sequential we can do it in parallel to speedup the process.</li>
  <li><strong>&lt;5&gt;</strong> For each URL we call <strong>extractMovieData</strong> function. This function contains code to extract movie content.</li>
</ul>

<p>Finally we are printing movie details to the console. At this point we will have <strong>Movie</strong> object which is returned from <strong>extractMovieData</strong> function. We can extend this example by utilizing any SQL library to save it in database. In the next section we will see the implementation of <strong>extractMovieData</strong> function.</p>

<h4 id="scrape-movie-page">Scrape movie page</h4>

<p>Once the movie details are extracted we need to save the details in a object so lets create a Movie class with required fields.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">Movie</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="nl">title:</span> <span class="n">String</span><span class="o">?</span> <span class="o">=</span> <span class="s">""</span>
    <span class="kt">var</span> <span class="nl">directedBy:</span> <span class="n">String</span> <span class="o">=</span> <span class="s">""</span>
    <span class="kt">var</span> <span class="nl">producedBy:</span> <span class="n">String</span> <span class="o">=</span> <span class="s">""</span>
    <span class="kt">var</span> <span class="nl">writtenBy:</span> <span class="n">String</span> <span class="o">=</span> <span class="s">""</span>
    <span class="kt">var</span> <span class="nl">starring:</span> <span class="n">String</span> <span class="o">=</span> <span class="s">""</span>
    <span class="kt">var</span> <span class="nl">musicBy:</span> <span class="n">String</span> <span class="o">=</span> <span class="s">""</span>
    <span class="kt">var</span> <span class="nl">releaseDate:</span> <span class="n">String</span> <span class="o">=</span> <span class="s">""</span>

    <span class="n">override</span> <span class="n">fun</span> <span class="nf">toString</span><span class="o">():</span> <span class="n">String</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"Movie(title='$title')"</span>
    <span class="o">}</span>

<span class="o">}</span> </code></pre></figure>

<p>This class holds all the Movie related information. Once we scrape the page we are going to create the instance of this class and populate the fields.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">fun</span> <span class="nf">extractMovieData</span><span class="o">(</span><span class="nl">url:</span> <span class="n">String</span><span class="o">):</span> <span class="n">Movie</span><span class="o">?</span> <span class="o">{</span> <span class="c1">// &lt;1&gt;</span>
    <span class="n">val</span> <span class="nl">doc:</span> <span class="n">Document</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">Jsoup</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="s">"$wiki$url"</span><span class="o">).</span><span class="na">get</span><span class="o">()</span>  <span class="c1">// &lt;2&gt;</span>
    <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nl">e:</span> <span class="n">Exception</span><span class="o">){</span>
        <span class="k">return</span> <span class="kc">null</span>
    <span class="o">}</span>

    <span class="n">val</span> <span class="n">movie</span> <span class="o">=</span> <span class="n">Movie</span><span class="o">()</span> <span class="c1">// &lt;3&gt;</span>
    <span class="n">doc</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">".infobox tr"</span><span class="o">)</span>   <span class="c1">// &lt;4&gt;</span>
            <span class="o">.</span><span class="na">forEach</span> <span class="o">{</span> <span class="n">ele</span> <span class="o">-&gt;</span>   <span class="c1">// &lt;5&gt;</span>
                <span class="n">when</span> <span class="o">{</span>
                    <span class="n">ele</span><span class="o">.</span><span class="na">getElementsByTag</span><span class="o">(</span><span class="s">"th"</span><span class="o">)?.</span><span class="na">hasClass</span><span class="o">(</span><span class="s">"summary"</span><span class="o">)</span> <span class="o">?:</span> <span class="kc">false</span> <span class="o">-&gt;</span> <span class="o">{</span>   <span class="c1">// &lt;6&gt;</span>
                        <span class="n">movie</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">ele</span><span class="o">.</span><span class="na">getElementsByTag</span><span class="o">(</span><span class="s">"th"</span><span class="o">)?.</span><span class="na">text</span><span class="o">()</span>
                    <span class="o">}</span>
                    <span class="k">else</span> <span class="o">-&gt;</span> <span class="o">{</span>
                        <span class="n">val</span> <span class="nl">value:</span> <span class="n">String</span><span class="o">?</span> <span class="o">=</span> <span class="k">if</span> <span class="o">(</span><span class="n">ele</span><span class="o">.</span><span class="na">getElementsByTag</span><span class="o">(</span><span class="s">"li"</span><span class="o">).</span><span class="na">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">)</span>
                            <span class="n">ele</span><span class="o">.</span><span class="na">getElementsByTag</span><span class="o">(</span><span class="s">"li"</span><span class="o">)</span>
                            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Element:</span><span class="o">:</span><span class="n">text</span><span class="o">)</span>
                            <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="nl">String:</span><span class="o">:</span><span class="n">isNotEmpty</span><span class="o">)</span>
                            <span class="o">.</span><span class="na">joinToString</span><span class="o">(</span><span class="s">", "</span><span class="o">)</span> <span class="k">else</span>
                            <span class="n">ele</span><span class="o">.</span><span class="na">getElementsByTag</span><span class="o">(</span><span class="s">"td"</span><span class="o">)?.</span><span class="na">first</span><span class="o">()?.</span><span class="na">text</span><span class="o">()</span> <span class="c1">// &lt;7&gt;</span>

                        <span class="n">when</span> <span class="o">(</span><span class="n">ele</span><span class="o">.</span><span class="na">getElementsByTag</span><span class="o">(</span><span class="s">"th"</span><span class="o">)?.</span><span class="na">first</span><span class="o">()?.</span><span class="na">text</span><span class="o">())</span> <span class="o">{</span>    <span class="c1">// &lt;8&gt;</span>
                            <span class="s">"Directed by"</span> <span class="o">-&gt;</span> <span class="n">movie</span><span class="o">.</span><span class="na">directedBy</span> <span class="o">=</span> <span class="n">value</span> <span class="o">?:</span> <span class="s">""</span>
                            <span class="s">"Produced by"</span> <span class="o">-&gt;</span> <span class="n">movie</span><span class="o">.</span><span class="na">producedBy</span> <span class="o">=</span> <span class="n">value</span> <span class="o">?:</span> <span class="s">""</span>
                            <span class="s">"Written by"</span> <span class="o">-&gt;</span> <span class="n">movie</span><span class="o">.</span><span class="na">writtenBy</span> <span class="o">=</span> <span class="n">value</span> <span class="o">?:</span> <span class="s">""</span>
                            <span class="s">"Starring"</span> <span class="o">-&gt;</span> <span class="n">movie</span><span class="o">.</span><span class="na">starring</span> <span class="o">=</span> <span class="n">value</span> <span class="o">?:</span> <span class="s">""</span>
                            <span class="s">"Music by"</span> <span class="o">-&gt;</span> <span class="n">movie</span><span class="o">.</span><span class="na">musicBy</span> <span class="o">=</span> <span class="n">value</span> <span class="o">?:</span> <span class="s">""</span>
                            <span class="s">"Release date"</span> <span class="o">-&gt;</span> <span class="n">movie</span><span class="o">.</span><span class="na">releaseDate</span> <span class="o">=</span> <span class="n">value</span> <span class="o">?:</span> <span class="s">""</span>
                            <span class="s">"title"</span> <span class="o">-&gt;</span> <span class="n">movie</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">value</span> <span class="o">?:</span> <span class="s">""</span>
                        <span class="o">}</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
    <span class="k">return</span> <span class="n">movie</span>
<span class="o">}</span></code></pre></figure>

<ul>
  <li><strong>&lt;1&gt;</strong> <strong>extractMovieData</strong> takes URL of the movie page</li>
  <li><strong>&lt;2&gt;</strong> Connect and parse the HTML document but some times wiki page might not be available for the movie then Jsoup throws the Exception. Handle it and return <strong>null</strong> if page is not available.</li>
  <li><strong>&lt;3&gt;</strong> For each movie create a new <strong>Movie</strong> instance.</li>
  <li><strong>&lt;4&gt;</strong> Wiki assigns class <strong>.infobox</strong> to the movie table and it contains all the required information. We will select all rows from the <strong>.infobox</strong> table. Below screenshot shows the <strong>.infobox</strong> selected in browser inspector.</li>
</ul>

<p><img src="/assets/images/posts/2019/03/wiki-movie-page.jpg" alt="Wiki Movie Page" height="500px" width="900px" class="align-center" /></p>

<ul>
  <li><strong>&lt;5&gt;</strong> <strong>forEach</strong> is executed for each row in the table and it provides <strong>Element</strong> reference to that row. Now we can examine this row and extract needed data.</li>
  <li><strong>&lt;6&gt;</strong> A row with <strong>.summary</strong> class will have title of the movie so we are checking if this element existing and if yes then set it to <strong>movie.title</strong>. <strong>ele.getElementsByTag(“th”)?.text()</strong> extracts the contents of the <strong>th</strong> element which contains movie title.</li>
  <li><strong>&lt;7&gt;</strong> This is a long expression with <strong>if..else</strong> condition. Wiki can have multiple values in some rows like multiple actors in <strong>Starring</strong> in this case we need to check for multiple list items and if exists then extract text from each item and join them with comma if not then just extract the text. Final result will be assigned to <strong>value</strong>.</li>
  <li><strong>&lt;8&gt;</strong> We have <strong>value</strong> but we need the column information so we can set this to proper field in the Movie instance. For example <strong>value</strong> in <strong>Produced by</strong> should be mapped to <strong>producedBy</strong> field in the Movie instance. First column in the row contains the header and we used <strong>when</strong> expression to check these values and for each matched column we assigned to the proper field in the movie instance.</li>
</ul>

<h3 id="parallel-vs-sequential-processing">Parallel vs Sequential processing</h3>

<p>We can process steams in parallel by just introducing <strong>parallelStream()</strong> call. We have more than 300 rows in the table and each row is independent of each other so we can process them in parallel and it will be fast. With parallelStream() it took 7 seconds to process all movies but when I removed <strong>parallelStream()</strong> then whole process took around 17 seconds because then movies are processed in sequential.</p>

<h3 id="conclusion">Conclusion</h3>

<p>We parsed list of movies in a Wiki page using Jsoup library and for each movie extracted the required data and created <strong>Movie</strong> instances.</p>

			</div>

            <!-- Post Date -->
            <p>
            <small>
                <span class="post-date"><time class="post-date" datetime="2019-03-13">13 Mar 2019</time></span>           
                
                </small>
            </p>
            
			<!-- Post Categories -->
			<div class="after-post-tags">
				<ul class="tags">
                    
                    
                    <li>
                     <a href="/category/kotlin/">kotlin</a>
                    </li>
                    
				</ul>
			</div>
			<!-- End Categories -->
            
            <!-- Prev/Next -->
            <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
            
            <a class="prev d-block col-md-6" href="http://thetechstack.net/create-web-application-with-ktor/"> &laquo; Create Web Application With Ktor</a>
            
            
            <a class="next d-block col-md-6 text-lg-right" href="http://thetechstack.net/deploy-serverless-kotlin-app-to-amazon-aws/">Deploy Serverless Kotlin App To Amazon AWS &raquo; </a>
            
            <div class="clearfix"></div>
            </div>
            <!-- End Categories -->

		</div>
		<!-- End Post -->

	</div>
</div>
<!-- End Article
================================================== -->

  

<!-- Begin Comments
================================================== -->

    <div class="container">
        <div id="comments" class="row justify-content-center mb-5">
            <div class="col-md-8">              
                
<section class="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'thetechstack-net'; 
        var disqus_developer = 0;
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = window.location.protocol + '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>
                
            </div>
        </div>
    </div>

<!--End Comments
================================================== -->
</div>

<!-- Bottom Alert Bar
================================================== -->
<div class="alertbar">
	<div class="container text-center">
		<span><img src="/" alt="Pradeep's Java and Kotlin blog"> &nbsp; Never miss any <b>article</b>, subscribe to my newsletter</span>
        <form action="https://thetechstack.us7.list-manage.com/subscribe/post?u=1381d872f022743eb338f00a1&amp;id=88d9fceb21" method="post" name="mc-embedded-subscribe-form" class="wj-contact-form validate" target="_blank" novalidate>
            <div class="mc-field-group">
            <input type="email" placeholder="Email" name="EMAIL" class="required email" id="mce-EMAIL" autocomplete="on" required>
            <input type="submit" value="Subscribe" name="subscribe" class="heart">
            </div>
        </form>
	</div>
</div>
    
</div>

<div class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
            <div class="d-md-flex align-items-center justify-content-center h-100">
                <h2 class="d-md-block align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2>
            </div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
            
          
             
              <a href="/category/java">Java (33)</a>
             
              <a href="/category/reactiveX">Reactivex (3)</a>
             
              <a href="/category/docker">Docker (2)</a>
             
              <a href="/category/tools">Tools (1)</a>
             
              <a href="/category/spring">Spring (2)</a>
             
              <a href="/category/kotlin">Kotlin (12)</a>
             
              <a href="/category/cloud">Cloud (1)</a>
            
          
        

		</div>
	</div>
</div>
 


<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                 Copyright © 2020 The Tech Stack . Net 
            </div>
            <!--<div class="col-md-6 col-sm-6 text-center text-lg-right">    
                <a target="_blank" href="https://www.wowthemes.net">Mediumish Theme</a> by WowThemes.net
            </div>-->
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

   
</div> 
<!-- Placed at the end of the document so the pages load faster -->
    
<script src="/assets/js/jquery.min.js"></script>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    
<script src="/assets/js/ie10-viewport-bug-workaround.js"></script>
    
<script src="/assets/js/mediumish.js"></script>
    
<script id="dsq-count-scr" src="//thetechstack-net.disqus.com/count.js"></script>
</body>
</html>
