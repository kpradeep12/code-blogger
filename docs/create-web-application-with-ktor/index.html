<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="google-site-verification" content="17GXTKdnqGMgpkrc7Kbz323f4wg41DzBsDcNsfnHmVo" />
<!--below verification is techstackjava.com-->
<meta name="google-site-verification" content="tuMqCtGo9Q2zjZ6e2k1iswdB1R56vqiqYfbSrrzlyRE" />
<meta name="google-site-verification" content="6prhbit_zvr5fgjCg8h5zm8eH7tQrVeMcbHGOhb393g" />
<!-- Twitter cards-->
<meta name="twitter:site"    content="@PradeepK4J">
<meta name="twitter:creator" content="@pradeep">
<meta name="twitter:title"   content="Create Web Application With Ktor">

<meta name="twitter:card"  content="summary_large_image">
<meta name="twitter:image" content="https://thetechstack.net/assets/images/banners/create-web-app-with-ktor.jpg">

<!-- end of Twitter cards -->


<link rel="icon" href="favicon-32x32.png">

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
    
<!--<title>Create Web Application With Ktor | The Tech Stack . Net</title>-->
    
<meta name="description" content="Learn how to create a web application using Ktor. I will create a demo application to understand it and see how to perform an end-to-end operations on an entity."> 
    
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
    
<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
    
<link href="/assets/css/screen.css" rel="stylesheet">
    
<link href="/assets/css/main.css" rel="stylesheet">
<link href="/assets/css/custom.css" rel="stylesheet">
<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Create Web Application With Ktor | Pradeep’s Java blog</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Create Web Application With Ktor" />
<meta name="author" content="pradeep" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Learn how to create a web application using Ktor. I will create a demo application to understand it and see how to perform an end-to-end operations on an entity." />
<meta property="og:description" content="Learn how to create a web application using Ktor. I will create a demo application to understand it and see how to perform an end-to-end operations on an entity." />
<link rel="canonical" href="https://thetechstack.net/create-web-application-with-ktor/" />
<meta property="og:url" content="https://thetechstack.net/create-web-application-with-ktor/" />
<meta property="og:site_name" content="Pradeep’s Java blog" />
<meta property="og:image" content="https://thetechstack.net/assets/images/banners/create-web-app-with-ktor.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-02-28T20:11:10-05:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"Create Web Application With Ktor","dateModified":"2019-02-28T20:11:10-05:00","datePublished":"2019-02-28T20:11:10-05:00","image":"https://thetechstack.net/assets/images/banners/create-web-app-with-ktor.jpg","url":"https://thetechstack.net/create-web-application-with-ktor/","mainEntityOfPage":{"@type":"WebPage","@id":"https://thetechstack.net/create-web-application-with-ktor/"},"author":{"@type":"Person","name":"pradeep"},"description":"Learn how to create a web application using Ktor. I will create a demo application to understand it and see how to perform an end-to-end operations on an entity.","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-115619272-1', 'auto');
  ga('send', 'pageview');
</script>


</head>
    


<body class="layout-post">

    
<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">
    
    <div class="container pr-0">    
    
    <!-- Begin Logo -->
    <a class="navbar-brand" href="/">
    <img src="/" alt="The Tech Stack . Net">
    </a>
    <!-- End Logo -->
  
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>
    
    <div class="collapse navbar-collapse" id="navbarMediumish">
       
        <!-- Begin Menu -->
        
            <ul class="navbar-nav ml-auto align-items-center">
                <!--
                
                <li class="nav-item">
                
                <a class="nav-link" href="/index.html">Blog</a>
                </li>-->

                <li class="nav-item">
                    <div>
                        <script async src="https://cse.google.com/cse.js?cx=a39f12b298f0f881d"></script>
                        <div class="gcse-search"></div>
                    </div>
                </li>
                
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="dropdown00" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Libraries</a>
                    <div class="dropdown-menu" aria-labelledby="dropdown00">
                        <a class="nav-link" href="/pages/library/docker-images-library/">Docker Image's</a>
                        <a class="nav-link" href="/pages/library/spring-boot-dependencies-library/">Spring Boot Dependencie's</a>
                    </div>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="dropdown01" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Quick Reference's</a>
                    <div class="dropdown-menu" aria-labelledby="dropdown01">
                        <a class="nav-link" href="/pages/quick-references/dockerfile-quick-reference/">Dockerfile</a>
                        <a class="nav-link" href="/pages/quick-references/junit-5-quick-reference/">JUnit 5</a>
                        
                    </div>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="dropdown02" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Cheat Sheet's</a>
                    <div class="dropdown-menu" aria-labelledby="dropdown02">
                        <a class="nav-link" href="/pages/cheat-sheets/docker-cli-cheat-sheet/">Docker CLI</a>
                        <!--<a class="nav-link" href="/pages/cheat-sheets/maven-cli-cheat-sheet/">Maven CLI</a>-->
                        <a class="nav-link" href="/pages/cheat-sheets/curl-http-cheat-sheet/">cURL CLI</a>
                        <a class="nav-link" href="/pages/cheat-sheets/git-cheat-sheet/">Git</a>
                        <!--<a class="nav-link" href="/pages/cheat-sheets/bash-cheat-sheet/">Bash</a>-->
                        <!--<a class="nav-link" href="/pages/cheat-sheets/markdown-cheat-sheet/">Markdown</a>-->
                    </div>
                </li>

                

                
                <li class="nav-item">
                
                <a class="nav-link" href="/about">About Me</a>
                </li>

                <!--
                
                <li class="nav-item">
                
                <a class="nav-link" href="/twitter">Twitter</a>
                </li>
                
                <li class="nav-item">
                <a target="_blank"  class="nav-link" href="https://twitter.com/PradeepK4J"><i class="fab fa-twitter"></i></a>
                </li>-->
                
            </ul>		
  
        <!-- End Menu -->

    </div>
        
    </div>
</nav>
<!-- End Navigation
================================================== -->
    
<div class="site-content">


<div class="container">

    
<!-- Site Title
================================================== -->
<!--<div class="mainheading">
    <h1 class="sitetitle">The Tech Stack . Net</h1>
    <p class="lead">
         Sharing my Java coding experiments
    </p>
</div>-->

    
    
<!-- Content
================================================== --> 
<div class="main-content">
    

<!-- Begin Article
================================================== -->
<div class="container">
	<div class="row">

		<!-- Post Share -->
		<div class="col-md-2 pl-0">            
           <div class="share">
    <p>
        Share
    </p>
    <ul>
        <li class="ml-1 mr-1">
        <a target="_blank" href="https://twitter.com/intent/tweet?text=Create Web Application With Ktor&url=https://thetechstack.net/create-web-application-with-ktor/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <i class="fab fa-twitter"></i>
        </a>
        </li>
        
        <li class="ml-1 mr-1">
        <a target="_blank" href="https://facebook.com/sharer.php?u=https://thetechstack.net/create-web-application-with-ktor/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
        <i class="fab fa-facebook-f"></i>
        </a>
        </li>
        
        <li class="ml-1 mr-1">
        <a target="_blank" href="https://plus.google.com/share?url=https://thetechstack.net/create-web-application-with-ktor/" onclick="window.open(this.href, 'facebook-google', 'width=550,height=435');return false;">
        <i class="fab fa-google"></i>
        </a>
        </li>
        
    </ul>
    
    <div class="sep">
    </div>				
    <ul>
        <li> 
        <a  class="small smoothscroll" href="#disqus_thread"></a>
        </li>
    </ul>
    
</div>  
		</div>
		

		<!-- Post -->        
        
        
		<div class="col-md-9 flex-first flex-md-unordered">
			<div class="mainheading">

                <!-- Author Box -->
                				
				<div class="row post-top-meta">
					<div class="col-md-2">
						<img class="author-thumb" src="/assets/images/author.jpg" alt="Pradeep Kundarapu">
					</div>
					<div class="col-md-10">
                        <a target="_blank" class="link-dark" href="https://thetechstack.net">Pradeep Kundarapu</a>
                        <a target="_blank" href="https://twitter.com/PradeepK4J" class="btn follow">Follow</a>
						<div class="author-description">Java developer, blogger and tech enthusiast.</div>						
					</div>
				</div>				
                
                
                <!-- Post Title -->
				<h1 class="posttitle">Create Web Application With Ktor</h1> 
                
			</div>

			<!-- Post Featured Image -->
			<img class="featured-image img-fluid" src="https://thetechstack.net/assets/images/banners/create-web-app-with-ktor.jpg" alt="Create Web Application With Ktor">
			<!-- End Featured Image -->

			<!-- Post Content -->
			<div class="article-post">
				<p>Its easy to develop a web application using <strong>Ktor</strong>, In this article I am going to explain the tools we need and the steps for developing a small CRUD based web application using <strong>Ktor</strong>. I will take <strong>Employee</strong> entity as an example to demonstrate this application. We are going to use below frameworks/libraries.</p>

<ul>
  <li><a href="https://ktor.io/">Ktor framework</a>: Develop asynchronous servers and clients.</li>
  <li><a href="https://freemarker.apache.org/">FreeMarker</a>: Template engine to generate text output. We are using it for HTML pages.</li>
  <li><a href="http://h2database.com/html/main.html">H2 database</a>: In-memory and very fast database.</li>
  <li><a href="https://github.com/JetBrains/Exposed">Exposed SQL library</a>: Light weight library for database access.</li>
</ul>

<p>If you are new to <strong>Exposed</strong> and <strong>Ktor framework</strong> then please go through below series of articles. These articles will explain them in more details.</p>

<ul>
  <li><a href="/light-weight-sql-kotlin-library">Exposed SQL Library</a></li>
  <li><a href="/rest-services-using-ktor">Ktor REST</a></li>
</ul>

<p>We are going to develop web pages using <strong>Freemarker</strong> and these pages will perform add/edit/delete operations on the employee entity. Lets get started.</p>

<ul id="markdown-toc">
  <li><a href="#create-kotlin-project" id="markdown-toc-create-kotlin-project">Create Kotlin project</a></li>
  <li><a href="#add-and-configure-ktor-framework" id="markdown-toc-add-and-configure-ktor-framework">Add and configure Ktor framework</a>    <ul>
      <li><a href="#configure-netty-embedded-server" id="markdown-toc-configure-netty-embedded-server">Configure Netty embedded server</a></li>
    </ul>
  </li>
  <li><a href="#dao-layer-for-database" id="markdown-toc-dao-layer-for-database">DAO layer for database</a>    <ul>
      <li><a href="#create-model-and-mapping" id="markdown-toc-create-model-and-mapping">Create Model and Mapping</a></li>
      <li><a href="#create-dao" id="markdown-toc-create-dao">Create DAO</a></li>
      <li><a href="#integrate-exposed-with-ktor" id="markdown-toc-integrate-exposed-with-ktor">Integrate Exposed with Ktor</a></li>
    </ul>
  </li>
  <li><a href="#configure-freemarker" id="markdown-toc-configure-freemarker">Configure FreeMarker</a>    <ul>
      <li><a href="#create-templates" id="markdown-toc-create-templates">Create templates</a></li>
      <li><a href="#declare-controllers" id="markdown-toc-declare-controllers">Declare controllers</a></li>
    </ul>
  </li>
  <li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li>
</ul>

<blockquote>
  <p>Please note that this whole project is available in <a href="https://github.com/kpradeep12/techstack-projects/tree/master/ktor-freemarker">github</a></p>
</blockquote>

<h3 id="create-kotlin-project">Create Kotlin project</h3>

<p>Execute below command to create an empty gradle Kotlin project. Once the project is created then import it into your favorite editor.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">mkdir </span>ktor-rest
<span class="nb">cd </span>ktor-rest
gradle init <span class="nt">--type</span> kotlin-application

Select build script DSL:
  1: groovy
  2: kotlin
Enter selection <span class="o">(</span>default: kotlin<span class="o">)</span> <span class="o">[</span>1..2] 

Project name <span class="o">(</span>default: ktor-rest<span class="o">)</span>: 
Source package <span class="o">(</span>default: ktor.rest<span class="o">)</span>: net.thetechstack</code></pre></figure>

<blockquote>
  <p>I executed this command on Gradle 5.2.1 version. You can choose to create kotlin project with any other build tool.</p>
</blockquote>

<p>This command will create new project with standard folder structure with default <strong>App.kt</strong> file.</p>

<h3 id="add-and-configure-ktor-framework">Add and configure Ktor framework</h3>

<p>Adding <strong>Ktor</strong> framework to the project is easy, just add below dependencies to your build.gradle</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">val</span> <span class="n">ktor_version</span> <span class="o">=</span> <span class="s">"1.1.3"</span>

<span class="n">dependencies</span> <span class="o">{</span>
    <span class="c1">//..</span>
    <span class="n">implementation</span><span class="o">(</span><span class="s">"io.ktor:ktor-server-core:$ktor_version"</span><span class="o">)</span>
    <span class="n">implementation</span><span class="o">(</span><span class="s">"io.ktor:ktor-server-netty:$ktor_version"</span><span class="o">)</span>
    <span class="c1">//Add logging support</span>
    <span class="n">implementation</span><span class="o">(</span><span class="s">"ch.qos.logback:logback-classic:1.2.3"</span><span class="o">)</span>
<span class="o">}</span></code></pre></figure>

<h4 id="configure-netty-embedded-server">Configure Netty embedded server</h4>

<p>Go to <strong>App.kt</strong> and update it with below code.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">net</span><span class="o">.</span><span class="na">thetechstack</span>

<span class="kn">import</span> <span class="nn">io.ktor.application.install</span>
<span class="kn">import</span> <span class="nn">io.ktor.features.CallLogging</span>
<span class="kn">import</span> <span class="nn">io.ktor.features.ContentNegotiation</span>
<span class="kn">import</span> <span class="nn">io.ktor.server.engine.embeddedServer</span>
<span class="kn">import</span> <span class="nn">io.ktor.server.netty.Netty</span>

<span class="n">fun</span> <span class="nf">main</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">embeddedServer</span><span class="o">(</span><span class="n">Netty</span><span class="o">,</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">8080</span><span class="o">){</span> <span class="o">}.</span><span class="na">start</span><span class="o">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="o">}</span></code></pre></figure>

<p><strong>embeddedServer</strong> function will initiate and run the embedded server and we passed below arguments to it;</p>

<ul>
  <li>Server instance type; We passed Netty. Ktor support Jetty and Tomcat as well.</li>
  <li>Port number on which the server will listen.</li>
  <li>Lambda instance of <strong>Application</strong>. Right now it is empty but we will add more details to it in next sections.</li>
</ul>

<h3 id="dao-layer-for-database">DAO layer for database</h3>

<p>We are using <strong>Exposed</strong> to connect and perform SQL operations on H2 in-memory database. We need to include required dependencies in the build.gradle so go to build.gradle and add below dependencies.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">dependencies</span> <span class="o">{</span>
    <span class="c1">//...</span>
    <span class="n">implementation</span><span class="o">(</span><span class="s">"org.jetbrains.exposed:exposed:0.12.1"</span><span class="o">)</span>
    <span class="c1">// H2 in-memory database</span>
    <span class="n">implementation</span><span class="o">(</span><span class="s">"com.h2database:h2:1.4.191"</span><span class="o">)</span>
    <span class="c1">// Exposed depends on Joda-time so include it</span>
    <span class="n">implementation</span><span class="o">(</span><span class="s">"joda-time:joda-time:2.9.2"</span><span class="o">)</span>
 
<span class="o">}</span></code></pre></figure>

<blockquote>
  <p>To learn more about SQL library <strong>Exposed</strong> please read this <a href="/light-weight-sql-kotlin-library">article</a></p>
</blockquote>

<h4 id="create-model-and-mapping">Create Model and Mapping</h4>

<p>We are using Employee entity as an example so lets create a new package <strong>net.thetechstack.model</strong> and add <strong>Employee.kt</strong> with below code.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">net</span><span class="o">.</span><span class="na">thetechstack</span><span class="o">.</span><span class="na">model</span>

<span class="n">data</span> <span class="kd">class</span> <span class="nf">Employee</span><span class="o">(</span><span class="n">val</span> <span class="nl">id:</span> <span class="n">Int</span><span class="o">,</span> <span class="n">val</span> <span class="nl">name:</span> <span class="n">String</span><span class="o">,</span>
                    <span class="n">val</span> <span class="nl">email:</span> <span class="n">String</span><span class="o">,</span> <span class="n">val</span> <span class="nl">city:</span> <span class="n">String</span><span class="o">)</span></code></pre></figure>

<p>This is a simple data class with four fields. We want to maintain id, name, email and city for the Employee so the constructor needs all these values.</p>

<p>Create a new package <strong>net.thetechstack.dao</strong> and add <strong>Employees.kt</strong> file with below content;</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">org.jetbrains.exposed.sql.Table</span>

<span class="n">object</span> <span class="nl">Employees:</span> <span class="n">Table</span><span class="o">(){</span>
    <span class="n">val</span> <span class="n">id</span> <span class="o">=</span> <span class="n">integer</span><span class="o">(</span><span class="s">"id"</span><span class="o">).</span><span class="na">primaryKey</span><span class="o">().</span><span class="na">autoIncrement</span><span class="o">()</span>
    <span class="n">val</span> <span class="n">name</span> <span class="o">=</span> <span class="n">varchar</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="mi">50</span><span class="o">)</span>
    <span class="n">val</span> <span class="n">email</span> <span class="o">=</span> <span class="n">varchar</span><span class="o">(</span><span class="s">"email"</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span>
    <span class="n">val</span> <span class="n">city</span> <span class="o">=</span> <span class="n">varchar</span><span class="o">(</span><span class="s">"city"</span><span class="o">,</span> <span class="mi">50</span><span class="o">)</span>
<span class="o">}</span></code></pre></figure>

<p>Employees is the mapping object for Employee. This object will give enough information for <strong>Exposed</strong> to map fields with the database table. This object acts like a object to table relational mapping.</p>

<h4 id="create-dao">Create DAO</h4>

<p>Instead of directly performing database operations we are creating <strong>DAO</strong> layer. DAO (Data Access Layer) will wrap all database operations in it. Create <strong>DAOFacadeDatabase.kt</strong> file in <strong>net.thetechstack.dao</strong> package with below code.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">net</span><span class="o">.</span><span class="na">thetechstack</span><span class="o">.</span><span class="na">dao</span>

<span class="kn">import</span> <span class="nn">net.thetechstack.model.Employee</span>
<span class="kn">import</span> <span class="nn">org.jetbrains.exposed.sql.*</span>
<span class="kn">import</span> <span class="nn">org.jetbrains.exposed.sql.transactions.transaction</span>
<span class="kn">import</span> <span class="nn">java.io.Closeable</span>

<span class="kd">interface</span> <span class="nc">DAOFacade</span><span class="o">:</span> <span class="n">Closeable</span><span class="o">{</span>
    <span class="n">fun</span> <span class="nf">init</span><span class="o">()</span>
    <span class="n">fun</span> <span class="nf">createEmployee</span><span class="o">(</span><span class="nl">name:</span><span class="n">String</span><span class="o">,</span> <span class="nl">email:</span><span class="n">String</span><span class="o">,</span> <span class="nl">city:</span><span class="n">String</span><span class="o">)</span>
    <span class="n">fun</span> <span class="nf">updateEmployee</span><span class="o">(</span><span class="nl">id:</span><span class="n">Int</span><span class="o">,</span> <span class="nl">name:</span><span class="n">String</span><span class="o">,</span> <span class="nl">email:</span><span class="n">String</span><span class="o">,</span> <span class="nl">city:</span><span class="n">String</span><span class="o">)</span>
    <span class="n">fun</span> <span class="nf">deleteEmployee</span><span class="o">(</span><span class="nl">id:</span><span class="n">Int</span><span class="o">)</span>
    <span class="n">fun</span> <span class="nf">getEmployee</span><span class="o">(</span><span class="nl">id:</span><span class="n">Int</span><span class="o">):</span> <span class="n">Employee</span><span class="o">?</span>
    <span class="n">fun</span> <span class="nf">getAllEmployees</span><span class="o">():</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span>
<span class="o">}</span></code></pre></figure>

<p>We created an interface, this defines the contract for DAO layer. We added all the methods needed to perform CRUD operations. With in the same class lets implement this interface.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nf">DAOFacadeDatabase</span><span class="o">(</span><span class="n">val</span> <span class="nl">db:</span> <span class="n">Database</span><span class="o">):</span> <span class="n">DAOFacade</span><span class="o">{</span>

    <span class="n">override</span> <span class="n">fun</span> <span class="nf">init</span><span class="o">()</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">(</span><span class="n">db</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">SchemaUtils</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">Employees</span><span class="o">)</span>
            <span class="c1">//Initial data</span>
            <span class="n">val</span> <span class="n">employees</span> <span class="o">=</span> <span class="n">listOf</span><span class="o">(</span><span class="n">Employee</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">"Owlette"</span><span class="o">,</span><span class="s">"owlette@techstack.net"</span><span class="o">,</span> <span class="s">"New York"</span><span class="o">),</span>
                    <span class="n">Employee</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="s">"Catboy"</span><span class="o">,</span><span class="s">"catboy@techstack.net"</span><span class="o">,</span> <span class="s">"New York"</span><span class="o">),</span>
                    <span class="n">Employee</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="s">"Grekko"</span><span class="o">,</span><span class="s">"grekko@techstack.net"</span><span class="o">,</span> <span class="s">"New York"</span><span class="o">))</span>
            <span class="n">Employees</span><span class="o">.</span><span class="na">batchInsert</span><span class="o">(</span><span class="n">employees</span><span class="o">){</span> <span class="n">employee</span> <span class="o">-&gt;</span>
                <span class="k">this</span><span class="o">[</span><span class="n">Employees</span><span class="o">.</span><span class="na">id</span><span class="o">]</span> <span class="o">=</span> <span class="n">employee</span><span class="o">.</span><span class="na">id</span>
                <span class="k">this</span><span class="o">[</span><span class="n">Employees</span><span class="o">.</span><span class="na">name</span><span class="o">]</span> <span class="o">=</span> <span class="n">employee</span><span class="o">.</span><span class="na">name</span>
                <span class="k">this</span><span class="o">[</span><span class="n">Employees</span><span class="o">.</span><span class="na">email</span><span class="o">]</span> <span class="o">=</span> <span class="n">employee</span><span class="o">.</span><span class="na">email</span>
                <span class="k">this</span><span class="o">[</span><span class="n">Employees</span><span class="o">.</span><span class="na">city</span><span class="o">]</span> <span class="o">=</span> <span class="n">employee</span><span class="o">.</span><span class="na">city</span>
            <span class="o">}</span>
            <span class="n">Unit</span>
        <span class="o">}</span>
    <span class="n">override</span> <span class="n">fun</span> <span class="nf">createEmployee</span><span class="o">(</span><span class="nl">name:</span> <span class="n">String</span><span class="o">,</span> <span class="nl">email:</span> <span class="n">String</span><span class="o">,</span> <span class="nl">city:</span> <span class="n">String</span><span class="o">)</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">(</span><span class="n">db</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Employees</span><span class="o">.</span><span class="na">insert</span> <span class="o">{</span><span class="n">it</span><span class="o">[</span><span class="n">Employees</span><span class="o">.</span><span class="na">name</span><span class="o">]</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
                <span class="n">it</span><span class="o">[</span><span class="n">Employees</span><span class="o">.</span><span class="na">email</span><span class="o">]</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span> <span class="n">it</span><span class="o">[</span><span class="n">Employees</span><span class="o">.</span><span class="na">city</span><span class="o">]</span> <span class="o">=</span> <span class="n">city</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="n">Unit</span>
        <span class="o">}</span>
    <span class="n">override</span> <span class="n">fun</span> <span class="nf">updateEmployee</span><span class="o">(</span><span class="nl">id:</span> <span class="n">Int</span><span class="o">,</span> <span class="nl">name:</span> <span class="n">String</span><span class="o">,</span> <span class="nl">email:</span> <span class="n">String</span><span class="o">,</span> <span class="nl">city:</span> <span class="n">String</span><span class="o">)</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">(</span><span class="n">db</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Employees</span><span class="o">.</span><span class="na">update</span><span class="o">({</span><span class="n">Employees</span><span class="o">.</span><span class="na">id</span> <span class="n">eq</span> <span class="n">id</span><span class="o">}){</span>
                <span class="n">it</span><span class="o">[</span><span class="n">Employees</span><span class="o">.</span><span class="na">name</span><span class="o">]</span> <span class="o">=</span> <span class="n">name</span>
                <span class="n">it</span><span class="o">[</span><span class="n">Employees</span><span class="o">.</span><span class="na">email</span><span class="o">]</span> <span class="o">=</span> <span class="n">email</span>
                <span class="n">it</span><span class="o">[</span><span class="n">Employees</span><span class="o">.</span><span class="na">city</span><span class="o">]</span> <span class="o">=</span> <span class="n">city</span>
            <span class="o">}</span>
            <span class="n">Unit</span>
        <span class="o">}</span>
    <span class="n">override</span> <span class="n">fun</span> <span class="nf">deleteEmployee</span><span class="o">(</span><span class="nl">id:</span> <span class="n">Int</span><span class="o">)</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">(</span><span class="n">db</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Employees</span><span class="o">.</span><span class="na">deleteWhere</span> <span class="o">{</span> <span class="n">Employees</span><span class="o">.</span><span class="na">id</span> <span class="n">eq</span> <span class="n">id</span> <span class="o">}</span>
        <span class="n">Unit</span>
    <span class="o">}</span>
    <span class="n">override</span> <span class="n">fun</span> <span class="nf">getEmployee</span><span class="o">(</span><span class="nl">id:</span> <span class="n">Int</span><span class="o">)</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">(</span><span class="n">db</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Employees</span><span class="o">.</span><span class="na">select</span> <span class="o">{</span> <span class="n">Employees</span><span class="o">.</span><span class="na">id</span> <span class="n">eq</span> <span class="n">id</span> <span class="o">}.</span><span class="na">map</span> <span class="o">{</span>
                <span class="n">Employee</span><span class="o">(</span><span class="n">it</span><span class="o">[</span><span class="n">Employees</span><span class="o">.</span><span class="na">id</span><span class="o">],</span> <span class="n">it</span><span class="o">[</span><span class="n">Employees</span><span class="o">.</span><span class="na">name</span><span class="o">],</span> <span class="n">it</span><span class="o">[</span><span class="n">Employees</span><span class="o">.</span><span class="na">email</span><span class="o">],</span> <span class="n">it</span><span class="o">[</span><span class="n">Employees</span><span class="o">.</span><span class="na">city</span><span class="o">]</span>
                <span class="o">)</span>
            <span class="o">}.</span><span class="na">singleOrNull</span><span class="o">()</span>
        <span class="o">}</span>
    <span class="n">override</span> <span class="n">fun</span> <span class="nf">getAllEmployees</span><span class="o">()</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">(</span><span class="n">db</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Employees</span><span class="o">.</span><span class="na">selectAll</span><span class="o">().</span><span class="na">map</span> <span class="o">{</span>
            <span class="n">Employee</span><span class="o">(</span><span class="n">it</span><span class="o">[</span><span class="n">Employees</span><span class="o">.</span><span class="na">id</span><span class="o">],</span> <span class="n">it</span><span class="o">[</span><span class="n">Employees</span><span class="o">.</span><span class="na">name</span><span class="o">],</span> <span class="n">it</span><span class="o">[</span><span class="n">Employees</span><span class="o">.</span><span class="na">email</span><span class="o">],</span> <span class="n">it</span><span class="o">[</span><span class="n">Employees</span><span class="o">.</span><span class="na">city</span><span class="o">]</span>
            <span class="o">)</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">override</span> <span class="n">fun</span> <span class="nf">close</span><span class="o">()</span> <span class="o">{</span> <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>DAOFacadeDatabase needs <strong>Database</strong> instance. We wrapped all query statements with in the <strong>transaction</strong> because <strong>Exposed</strong> needs all the database operations to be performed with in a transaction.</p>

<blockquote>
  <p>To understand more about Exposed please read this <a href="/light-weight-sql-kotlin-library">article</a></p>
</blockquote>

<p>Now we have our DAO layer ready.</p>

<h4 id="integrate-exposed-with-ktor">Integrate Exposed with Ktor</h4>

<p>Lets integrate DAO layer with Ktor. We need to instantiate <strong>DAOFacadeDatabase</strong> by passing H2 in-memory database instance. Update <strong>Application.kt</strong> with below code;</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">val</span> <span class="n">dao</span> <span class="o">=</span> <span class="n">DAOFacadeDatabase</span><span class="o">(</span><span class="n">Database</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="s">"jdbc:h2:mem:test;DB_CLOSE_DELAY=-1"</span><span class="o">,</span> <span class="n">driver</span> <span class="o">=</span> <span class="s">"org.h2.Driver"</span><span class="o">))</span>
<span class="n">fun</span> <span class="nf">main</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">embeddedServer</span><span class="o">(</span><span class="n">Netty</span><span class="o">,</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">8080</span><span class="o">){</span>
        <span class="n">dao</span><span class="o">.</span><span class="na">init</span><span class="o">()</span>
    <span class="o">}.</span><span class="na">start</span><span class="o">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span></code></pre></figure>

<p>Instantiated <strong>DAOFacadeDatabase</strong> by passing H2 database instance and used this instance to create the tables by calling <strong>init()</strong></p>

<h3 id="configure-freemarker">Configure FreeMarker</h3>

<p>Update build.gradle with below dependency to add support for FreeMarker templates;</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">dependencies</span> <span class="o">{</span>
    <span class="c1">// ...</span>
    <span class="n">implementation</span><span class="o">(</span><span class="s">"io.ktor:ktor-freemarker:$ktor_version"</span><span class="o">)</span>
<span class="o">}</span></code></pre></figure>

<p>We will save all our FreeMarker templates in <strong>resources/templates</strong> directory so create this directory under <strong>ktor-freemarker/src/main/</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">embeddedServer</span><span class="o">(</span><span class="n">Netty</span><span class="o">,</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">8080</span><span class="o">){</span>
        <span class="n">dao</span><span class="o">.</span><span class="na">init</span><span class="o">()</span>
        <span class="n">install</span><span class="o">(</span><span class="n">FreeMarker</span><span class="o">){</span>
            <span class="n">templateLoader</span> <span class="o">=</span> <span class="n">ClassTemplateLoader</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="kd">class</span><span class="err">.</span><span class="nc">java</span><span class="o">.</span><span class="na">classLoader</span><span class="o">,</span> <span class="s">"templates"</span><span class="o">)</span>
        <span class="o">}</span>
    <span class="o">}.</span><span class="na">start</span><span class="o">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span></code></pre></figure>

<p>We installed <strong>FreeMarker</strong> feature on the request and response pipeline by passing FreeMarker configuration to <strong>install</strong> function. We are going to save all our FreeMarker templates in <strong>templates</strong> folder so we passed this to FreeMarker configuration. Now FreeMarker will check templates in <strong>src/main/resources/templates</strong> folder</p>

<h4 id="create-templates">Create templates</h4>

<p>We need three template files;</p>

<ul>
  <li><strong>template.ftl</strong>: This is the base template of our application. This contains the page layout.</li>
  <li><strong>index.ftl</strong>: Main page with list of all employees and gives options to add/edit/delete employees.</li>
  <li><strong>employee.ftl</strong>: Allows us to add/edit employee.</li>
</ul>

<p><strong>template.ftl</strong></p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;</span><span class="err">#</span><span class="na">macro</span> <span class="na">mainLayout</span> <span class="na">title=</span><span class="s">"Welcome to Employee Database"</span><span class="nt">&gt;</span>
<span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>${title}<span class="nt">&lt;/title&gt;</span>
        <span class="c">&lt;!-- Required meta tags --&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1, shrink-to-fit=no"</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- Bootstrap CSS --&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"</span> <span class="na">integrity=</span><span class="s">"sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"</span> <span class="na">crossorigin=</span><span class="s">"anonymous"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row m-1"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;h3&gt;</span>Employees<span class="nt">&lt;/h3&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row m-1"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;</span><span class="err">#</span><span class="na">nested</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
<span class="nt">&lt;/</span><span class="err">#</span><span class="nt">macro&gt;</span></code></pre></figure>

<p>This is a simple HTML page uses <strong>Bootstrap</strong> CSS for styling and has some FreeMarker directives <strong>macro</strong> and <strong>nested</strong>.</p>

<p><strong>Macro</strong> is used to store reusable templates and we can give it a name to refer them later. In below code I created a macro with named <strong>test</strong>. This macro contains reusable block, in this case it is having <strong>Hello</strong> with in <strong>p</strong> tag. If I want to output <em>Hello</em> then we call this macro <strong>&lt;@test/&gt;</strong> then the macro will be executed. Below code will output ‘Hello’ two times.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;</span><span class="err">#</span><span class="na">macro</span> <span class="na">test</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p&gt;</span>Hello<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/</span><span class="err">#</span><span class="nt">macro&gt;</span>

<span class="nt">&lt;</span><span class="err">@</span><span class="na">test</span><span class="nt">/&gt;</span>
<span class="nt">&lt;</span><span class="err">@</span><span class="na">test</span><span class="nt">/&gt;</span></code></pre></figure>

<p>Macro can take input parameters and we can use them with in the template.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;</span><span class="err">#</span><span class="na">macro</span> <span class="na">test</span> <span class="na">name</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p&gt;</span>Hello ${name}<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/</span><span class="err">#</span><span class="nt">macro&gt;</span>

<span class="nt">&lt;</span><span class="err">@</span><span class="na">test</span> <span class="na">name=</span><span class="s">"World"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;</span><span class="err">@</span><span class="na">test</span> <span class="na">name=</span><span class="s">"FreeMarker"</span><span class="nt">/&gt;</span></code></pre></figure>

<blockquote>
  <p>More information on the macro is available on the <a href="https://freemarker.apache.org/docs/ref_directive_macro.html">FreeMarker site</a>.</p>
</blockquote>

<p>Instead of Macro having its own content we can pass content to it using <strong>Nested</strong>. Macro acts like a border around the <strong>nested</strong>. In below example we are passing ‘Hello’ to it and macro will replace &lt;#nested&gt; with the content.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;</span><span class="err">#</span><span class="na">macro</span> <span class="na">test</span><span class="nt">&gt;</span>
    <span class="nt">&lt;</span><span class="err">#</span><span class="na">nested</span><span class="nt">&gt;</span>
<span class="nt">&lt;/</span><span class="err">#</span><span class="nt">macro&gt;</span>
<span class="nt">&lt;</span><span class="err">@</span><span class="na">test</span><span class="nt">&gt;&lt;p&gt;</span>Hello<span class="nt">&lt;/p&gt;&lt;/</span><span class="err">@</span><span class="nt">test&gt;</span></code></pre></figure>

<p>In <strong>template.ftl</strong> we uses <strong>macro</strong> and <strong>nested</strong> to define our web page structure. We called our macro as <em>mainLayout</em> now we can use this in other template files.</p>

<p><strong>index.ftl</strong></p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;</span><span class="err">#</span><span class="na">import</span> <span class="err">"</span><span class="na">template</span><span class="err">.</span><span class="na">ftl</span><span class="err">"</span> <span class="na">as</span> <span class="na">layout</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;</span><span class="err">@</span><span class="na">layout</span><span class="err">.</span><span class="na">mainLayout</span><span class="nt">&gt;</span>
    <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;thead</span> <span class="na">class=</span><span class="s">"thead-dark"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>Id<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>Name<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>Email<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>City<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th&gt;&lt;/th&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
        <span class="nt">&lt;/thead&gt;</span>
        <span class="nt">&lt;tbody&gt;</span>
            <span class="nt">&lt;</span><span class="err">#</span><span class="na">list</span> <span class="na">employees</span> <span class="na">as</span> <span class="na">emp</span><span class="nt">&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;td&gt;</span>${emp.id}<span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;</span>${emp.name}<span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;</span>${emp.email}<span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;</span>${emp.city}<span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;td&gt;</span>
                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/employee?action=edit&amp;id=${emp.id}"</span> <span class="na">class=</span><span class="s">"btn btn-secondary float-right mr-2"</span> <span class="na">role=</span><span class="s">"button"</span><span class="nt">&gt;</span>Edit<span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/delete?id=${emp.id}"</span> <span class="na">class=</span><span class="s">"btn btn-danger float-right mr-2"</span> <span class="na">role=</span><span class="s">"button"</span><span class="nt">&gt;</span>Delete<span class="nt">&lt;/a&gt;</span>
                <span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;/</span><span class="err">#</span><span class="nt">list&gt;</span>
        <span class="nt">&lt;/tbody&gt;</span>
    <span class="nt">&lt;/table&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/employee?action=new"</span> <span class="na">class=</span><span class="s">"btn btn-secondary float-right"</span> <span class="na">role=</span><span class="s">"button"</span><span class="nt">&gt;</span>New Employee<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/</span><span class="err">@</span><span class="nt">layout</span><span class="err">.mainLayout</span><span class="nt">&gt;</span></code></pre></figure>

<p>We imported template.ftl as layout and used it in <strong>index.ftl</strong>. In this page we display all employees and allows users to add/edit/delete employees. <strong>list</strong> directive will allow us to iterate employees. To add/edit we are passing <strong>action</strong> query parameter and for delete we are passing <strong>id</strong></p>

<p><strong>employee.ftl</strong></p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;</span><span class="err">#</span><span class="na">import</span> <span class="err">"</span><span class="na">template</span><span class="err">.</span><span class="na">ftl</span><span class="err">"</span> <span class="na">as</span> <span class="na">layout</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;</span><span class="err">@</span><span class="na">layout</span><span class="err">.</span><span class="na">mainLayout</span> <span class="na">title=</span><span class="s">"New Employee"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/employee"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"name"</span><span class="nt">&gt;</span>Name<span class="nt">&lt;/label&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"name"</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">placeholder=</span><span class="s">"Enter Name"</span> <span class="na">value=</span><span class="s">"${(employee.name)!}"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"email"</span><span class="nt">&gt;</span>Email<span class="nt">&lt;/label&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"email"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"email"</span> <span class="na">name=</span><span class="s">"email"</span> <span class="na">placeholder=</span><span class="s">"Enter Email"</span> <span class="na">value=</span><span class="s">"${(employee.email)!}"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"city"</span><span class="nt">&gt;</span>City<span class="nt">&lt;/label&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"city"</span> <span class="na">name=</span><span class="s">"city"</span> <span class="na">placeholder=</span><span class="s">"Enter City"</span> <span class="na">value=</span><span class="s">"${(employee.city)!}"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">id=</span><span class="s">"action"</span> <span class="na">name=</span><span class="s">"action"</span> <span class="na">value=</span><span class="s">"${action}"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">id=</span><span class="s">"id"</span> <span class="na">name=</span><span class="s">"id"</span> <span class="na">value=</span><span class="s">"${(employee.id)!}"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-primary"</span><span class="nt">&gt;</span>Submit<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/</span><span class="err">@</span><span class="nt">layout</span><span class="err">.mainLayout</span><span class="nt">&gt;</span></code></pre></figure>

<p>This template is for new/edit employee records. <strong>action</strong> field in the form is used to maintain the type of action and <strong>id</strong> contains the employee id which server can use to update it. On submit form will be submitted to <strong>/employee</strong>.</p>

<h4 id="declare-controllers">Declare controllers</h4>

<p>Update <strong>App.kt</strong> with below code to create HTTP end-points.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">embeddedServer</span><span class="o">(</span><span class="n">Netty</span><span class="o">,</span> <span class="mi">8080</span><span class="o">){</span>
        <span class="c1">// ..</span>
        <span class="n">routing</span> <span class="o">{</span>
            <span class="n">route</span><span class="o">(</span><span class="s">"/"</span><span class="o">){</span>
                <span class="n">get</span><span class="o">{</span>
                    <span class="n">call</span><span class="o">.</span><span class="na">respond</span><span class="o">(</span><span class="n">FreeMarkerContent</span><span class="o">(</span><span class="s">"index.ftl"</span><span class="o">,</span> <span class="n">mapOf</span><span class="o">(</span><span class="s">"employees"</span> <span class="n">to</span> <span class="n">dao</span><span class="o">.</span><span class="na">getAllEmployees</span><span class="o">())))</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="n">route</span><span class="o">(</span><span class="s">"/employee"</span><span class="o">){</span>
                <span class="n">get</span> <span class="o">{</span>
                    <span class="n">val</span> <span class="n">action</span> <span class="o">=</span> <span class="o">(</span><span class="n">call</span><span class="o">.</span><span class="na">request</span><span class="o">.</span><span class="na">queryParameters</span><span class="o">[</span><span class="s">"action"</span><span class="o">]</span> <span class="o">?:</span> <span class="s">"new"</span><span class="o">)</span>
                    <span class="n">when</span><span class="o">(</span><span class="n">action</span><span class="o">){</span>
                        <span class="s">"new"</span> <span class="o">-&gt;</span> <span class="n">call</span><span class="o">.</span><span class="na">respond</span><span class="o">(</span><span class="n">FreeMarkerContent</span><span class="o">(</span><span class="s">"employee.ftl"</span><span class="o">,</span>
                                    <span class="n">mapOf</span><span class="o">(</span><span class="s">"action"</span> <span class="n">to</span> <span class="n">action</span><span class="o">)))</span>
                        <span class="s">"edit"</span> <span class="o">-&gt;</span> <span class="o">{</span>
                            <span class="n">val</span> <span class="n">id</span> <span class="o">=</span> <span class="n">call</span><span class="o">.</span><span class="na">request</span><span class="o">.</span><span class="na">queryParameters</span><span class="o">[</span><span class="s">"id"</span><span class="o">]</span>
                            <span class="k">if</span><span class="o">(</span><span class="n">id</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
                                <span class="n">call</span><span class="o">.</span><span class="na">respond</span><span class="o">(</span><span class="n">FreeMarkerContent</span><span class="o">(</span><span class="s">"employee.ftl"</span><span class="o">,</span>
                                        <span class="n">mapOf</span><span class="o">(</span><span class="s">"employee"</span> <span class="n">to</span> <span class="n">dao</span><span class="o">.</span><span class="na">getEmployee</span><span class="o">(</span><span class="n">id</span><span class="o">.</span><span class="na">toInt</span><span class="o">()),</span>
                                                <span class="s">"action"</span> <span class="n">to</span> <span class="n">action</span><span class="o">)))</span>
                            <span class="o">}</span>
                        <span class="o">}</span>
                    <span class="o">}</span>
                <span class="o">}</span>
                <span class="n">post</span><span class="o">{</span>
                    <span class="n">val</span> <span class="nl">postParameters:</span> <span class="n">Parameters</span> <span class="o">=</span> <span class="n">call</span><span class="o">.</span><span class="na">receiveParameters</span><span class="o">()</span>
                    <span class="n">val</span> <span class="n">action</span> <span class="o">=</span> <span class="n">postParameters</span><span class="o">[</span><span class="s">"action"</span><span class="o">]</span> <span class="o">?:</span> <span class="s">"new"</span>
                    <span class="n">when</span><span class="o">(</span><span class="n">action</span><span class="o">){</span>
                        <span class="s">"new"</span> <span class="o">-&gt;</span> <span class="n">dao</span><span class="o">.</span><span class="na">createEmployee</span><span class="o">(</span><span class="n">postParameters</span><span class="o">[</span><span class="s">"name"</span><span class="o">]</span> <span class="o">?:</span> <span class="s">""</span><span class="o">,</span> <span class="n">postParameters</span><span class="o">[</span><span class="s">"email"</span><span class="o">]</span> <span class="o">?:</span> <span class="s">""</span><span class="o">,</span> <span class="n">postParameters</span><span class="o">[</span><span class="s">"city"</span><span class="o">]</span> <span class="o">?:</span> <span class="s">""</span><span class="o">)</span>
                        <span class="s">"edit"</span> <span class="o">-&gt;{</span>
                            <span class="n">val</span> <span class="n">id</span> <span class="o">=</span> <span class="n">postParameters</span><span class="o">[</span><span class="s">"id"</span><span class="o">]</span>
                            <span class="k">if</span><span class="o">(</span><span class="n">id</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
                                <span class="n">dao</span><span class="o">.</span><span class="na">updateEmployee</span><span class="o">(</span><span class="n">id</span><span class="o">.</span><span class="na">toInt</span><span class="o">(),</span> <span class="n">postParameters</span><span class="o">[</span><span class="s">"name"</span><span class="o">]</span> <span class="o">?:</span> <span class="s">""</span><span class="o">,</span> <span class="n">postParameters</span><span class="o">[</span><span class="s">"email"</span><span class="o">]</span> <span class="o">?:</span> <span class="s">""</span><span class="o">,</span> <span class="n">postParameters</span><span class="o">[</span><span class="s">"city"</span><span class="o">]</span> <span class="o">?:</span> <span class="s">""</span><span class="o">)</span>
                        <span class="o">}</span>
                    <span class="o">}</span>
                    <span class="n">call</span><span class="o">.</span><span class="na">respond</span><span class="o">(</span><span class="n">FreeMarkerContent</span><span class="o">(</span><span class="s">"index.ftl"</span><span class="o">,</span> <span class="n">mapOf</span><span class="o">(</span><span class="s">"employees"</span> <span class="n">to</span> <span class="n">dao</span><span class="o">.</span><span class="na">getAllEmployees</span><span class="o">())))</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="n">route</span><span class="o">(</span><span class="s">"/delete"</span><span class="o">){</span>
                <span class="n">get</span><span class="o">{</span>
                    <span class="n">val</span> <span class="n">id</span> <span class="o">=</span> <span class="n">call</span><span class="o">.</span><span class="na">request</span><span class="o">.</span><span class="na">queryParameters</span><span class="o">[</span><span class="s">"id"</span><span class="o">]</span>
                    <span class="k">if</span><span class="o">(</span><span class="n">id</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
                        <span class="n">dao</span><span class="o">.</span><span class="na">deleteEmployee</span><span class="o">(</span><span class="n">id</span><span class="o">.</span><span class="na">toInt</span><span class="o">())</span>
                        <span class="n">call</span><span class="o">.</span><span class="na">respond</span><span class="o">(</span><span class="n">FreeMarkerContent</span><span class="o">(</span><span class="s">"index.ftl"</span><span class="o">,</span> <span class="n">mapOf</span><span class="o">(</span><span class="s">"employees"</span> <span class="n">to</span> <span class="n">dao</span><span class="o">.</span><span class="na">getAllEmployees</span><span class="o">())))</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}.</span><span class="na">start</span><span class="o">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span></code></pre></figure>

<ul>
  <li><strong>/</strong>: Loads index.ftl by setting all employees in <strong>employees</strong> key. We use this key in the template to iterate and display all employees in the HTML table.</li>
  <li><strong>/employee</strong>:
    <ul>
      <li><strong>GET</strong>: Loads <strong>employee.ftl</strong>. To handle <strong>edit</strong> we fetch the employee record and set it in the map.</li>
      <li><strong>POST</strong>: Loads <strong>index.ftl</strong> after the action. <strong>new</strong> will create new employee and <strong>edit</strong> will update the record.</li>
    </ul>
  </li>
  <li><strong>/delete</strong>: Deletes employee and loads <strong>index.ftl</strong></li>
</ul>

<p>Below is the demo run of the application.</p>

<p><img src="/assets/images/posts/2019/03/web-app-with-ktor.gif" alt="Web application with Ktor" height="407px" width="719px" class="align-center" /></p>

<h3 id="conclusion">Conclusion</h3>

<p>We developed a simple web application using Ktor framework and used many other libraries to perform CRUD operations on an entity.</p>

			</div>

            <!-- Post Date -->
            <p>
            <small>
                <span class="post-date"><time class="post-date" datetime="2019-02-28">28 Feb 2019</time></span>           
                
                </small>
            </p>
            
			<!-- Post Categories -->
			<div class="after-post-tags">
				<ul class="tags">
                    
                    
                    <li>
                     <a href="/category/kotlin/">kotlin</a>
                    </li>
                    
				</ul>
			</div>
			<!-- End Categories -->
            
            <!-- Prev/Next -->
            <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
            
            <a class="prev d-block col-md-6" href="https://thetechstack.net/rest-services-using-ktor/"> &laquo; Create REST services using Ktor</a>
            
            
            <a class="next d-block col-md-6 text-lg-right" href="https://thetechstack.net/using-jsoup-with-kotlin-to-scrape-wiki-pages/">Using Jsoup With Kotlin To Scrape Wiki Pages &raquo; </a>
            
            <div class="clearfix"></div>
            </div>
            <!-- End Categories -->

		</div>
		<!-- End Post -->

	</div>
</div>
<!-- End Article
================================================== -->

  

<!-- Begin Comments
================================================== -->

    <div class="container">
        <div id="comments" class="row justify-content-center mb-5">
            <div class="col-md-8">              
                
<section class="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'thetechstack-net'; 
        var disqus_developer = 0;
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = window.location.protocol + '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>
                
            </div>
        </div>
    </div>

<!--End Comments
================================================== -->


</div>

<!-- Bottom Alert Bar
================================================== -->
<div class="alertbar">
	<div class="container text-center">
		<span>Never miss any <b>article</b>, subscribe to my newsletter</span>
        <form action="https://thetechstack.us7.list-manage.com/subscribe/post?u=1381d872f022743eb338f00a1&amp;id=88d9fceb21" method="post" name="mc-embedded-subscribe-form" class="wj-contact-form validate" target="_blank" novalidate>
            <div class="mc-field-group">
            <input type="email" placeholder="Email" name="EMAIL" class="required email" id="mce-EMAIL" autocomplete="on" required>
            <input type="submit" value="Subscribe" name="subscribe" class="heart">
            </div>
        </form>
	</div>
</div>
    
</div>
<!--
<div class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
            <div class="d-md-flex align-items-center justify-content-center h-100">
                <h2 class="d-md-block align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2>
            </div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
            
          
             
              <a href="/category/java">Java (35)</a>
             
              <a href="/category/reactiveX">Reactivex (3)</a>
             
              <a href="/category/docker">Docker (2)</a>
             
              <a href="/category/tools">Tools (1)</a>
             
              <a href="/category/spring">Spring (4)</a>
             
              <a href="/category/kotlin">Kotlin (12)</a>
             
              <a href="/category/cloud">Cloud (1)</a>
             
              <a href="/category/git">Git (1)</a>
             
              <a href="/category/workflow">Workflow (1)</a>
            
          
        

		</div>
	</div>
</div>
 -->


<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                 Copyright © 2021 The Tech Stack . Net 
            </div>
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

   
</div> 
<!-- Placed at the end of the document so the pages load faster -->
    
<script src="/assets/js/jquery.min.js"></script>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    
<script src="/assets/js/ie10-viewport-bug-workaround.js"></script>
    
<script src="/assets/js/mediumish.js"></script>
    
<script id="dsq-count-scr" src="//thetechstack-net.disqus.com/count.js"></script>
</body>
</html>
