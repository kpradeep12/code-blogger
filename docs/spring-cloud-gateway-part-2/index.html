<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="google-site-verification" content="17GXTKdnqGMgpkrc7Kbz323f4wg41DzBsDcNsfnHmVo" />
<!--below verification is techstackjava.com-->
<meta name="google-site-verification" content="tuMqCtGo9Q2zjZ6e2k1iswdB1R56vqiqYfbSrrzlyRE" />
<meta name="google-site-verification" content="6prhbit_zvr5fgjCg8h5zm8eH7tQrVeMcbHGOhb393g" />
<!-- Twitter cards-->
<meta name="twitter:site"    content="@PradeepK4J">
<meta name="twitter:creator" content="@pradeep">
<meta name="twitter:title"   content="Spring Cloud Gateway - Part 2">

<meta name="twitter:card"  content="summary_large_image">
<meta name="twitter:image" content="http://thetechstack.net/assets/images/banners/spring-cloud-gateway-part-2.png">

<!-- end of Twitter cards -->


<link rel="icon" href="/assets/images/logo.png">
    
<!--<title>Spring Cloud Gateway - Part 2 | The Tech Stack . Net</title>-->
    
<meta name="description" content="This is the second part of Spring cloud gateway tutorial. We will learn the basics and configure the Spring Cloud Gateway. We will go through the sample project and run it to see the results, and also, we will see how to configure Filters to change request and response."> 
    
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
    
<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
    
<link href="/assets/css/screen.css" rel="stylesheet">
    
<link href="/assets/css/main.css" rel="stylesheet">
<link href="/assets/css/custom.css" rel="stylesheet">
<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Spring Cloud Gateway - Part 2 | Pradeep’s Java blog</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Spring Cloud Gateway - Part 2" />
<meta name="author" content="pradeep" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This is the second part of Spring cloud gateway tutorial. We will learn the basics and configure the Spring Cloud Gateway. We will go through the sample project and run it to see the results, and also, we will see how to configure Filters to change request and response." />
<meta property="og:description" content="This is the second part of Spring cloud gateway tutorial. We will learn the basics and configure the Spring Cloud Gateway. We will go through the sample project and run it to see the results, and also, we will see how to configure Filters to change request and response." />
<link rel="canonical" href="http://thetechstack.net/spring-cloud-gateway-part-2/" />
<meta property="og:url" content="http://thetechstack.net/spring-cloud-gateway-part-2/" />
<meta property="og:site_name" content="Pradeep’s Java blog" />
<meta property="og:image" content="http://thetechstack.net/assets/images/banners/spring-cloud-gateway-part-2.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-11-30T12:11:10-05:00" />
<script type="application/ld+json">
{"image":"http://thetechstack.net/assets/images/banners/spring-cloud-gateway-part-2.png","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://thetechstack.net/spring-cloud-gateway-part-2/"},"dateModified":"2020-11-30T12:11:10-05:00","url":"http://thetechstack.net/spring-cloud-gateway-part-2/","author":{"@type":"Person","name":"pradeep"},"headline":"Spring Cloud Gateway - Part 2","description":"This is the second part of Spring cloud gateway tutorial. We will learn the basics and configure the Spring Cloud Gateway. We will go through the sample project and run it to see the results, and also, we will see how to configure Filters to change request and response.","datePublished":"2020-11-30T12:11:10-05:00","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-115619272-1', 'auto');
  ga('send', 'pageview');
</script>


</head>
    


<body class="layout-post">

    
<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">
    
    <div class="container pr-0">    
    
    <!-- Begin Logo -->
    <a class="navbar-brand" href="/">
    <img src="/" alt="The Tech Stack . Net">
    </a>
    <!-- End Logo -->
  
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>
    
    
    <div class="collapse navbar-collapse" id="navbarMediumish">
       
        <!-- Begin Menu -->
        
            <ul class="navbar-nav ml-auto">
                <!--
                
                <li class="nav-item">
                
                <a class="nav-link" href="/index.html">Blog</a>
                </li>-->
                
                
                <li class="nav-item">
                
                <a class="nav-link" href="/pages/cheat-sheets/git-cheat-sheet/">Git Cheat Sheet</a>
                </li>

                
                <li class="nav-item">
                
                <a class="nav-link" href="/about">About Me</a>
                </li>
                
                
                <li class="nav-item">
                
                <a class="nav-link" href="/twitter">Twitter</a>
                </li>
                <!--
                <li class="nav-item">
                <a target="_blank"  class="nav-link" href="https://twitter.com/PradeepK4J"><i class="fab fa-twitter"></i></a>
                </li>-->
                
            </ul>		
  
        <!-- End Menu -->

    </div>
        
    </div>
</nav>
<!-- End Navigation
================================================== -->
    
<div class="site-content">   
<div class="container">
    
<!-- Site Title
================================================== -->
<!--<div class="mainheading">
    <h1 class="sitetitle">The Tech Stack . Net</h1>
    <p class="lead">
         Sharing my Java coding experiments
    </p>
</div>-->

    
    
<!-- Content
================================================== --> 
<div class="main-content">
    <!-- Begin Article
================================================== -->
<div class="container">
	<div class="row">

		<!-- Post Share -->
		<div class="col-md-2 pl-0">            
           <div class="share">
    <p>
        Share
    </p>
    <ul>
        <li class="ml-1 mr-1">
        <a target="_blank" href="https://twitter.com/intent/tweet?text=Spring Cloud Gateway - Part 2&url=http://thetechstack.net/spring-cloud-gateway-part-2/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <i class="fab fa-twitter"></i>
        </a>
        </li>
        
        <li class="ml-1 mr-1">
        <a target="_blank" href="https://facebook.com/sharer.php?u=http://thetechstack.net/spring-cloud-gateway-part-2/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
        <i class="fab fa-facebook-f"></i>
        </a>
        </li>
        
        <li class="ml-1 mr-1">
        <a target="_blank" href="https://plus.google.com/share?url=http://thetechstack.net/spring-cloud-gateway-part-2/" onclick="window.open(this.href, 'facebook-google', 'width=550,height=435');return false;">
        <i class="fab fa-google"></i>
        </a>
        </li>
        
    </ul>
    
    <div class="sep">
    </div>				
    <ul>
        <li> 
        <a  class="small smoothscroll" href="#disqus_thread"></a>
        </li>
    </ul>
    
</div>  
		</div>
		

		<!-- Post -->        
        
        
		<div class="col-md-9 flex-first flex-md-unordered">
			<div class="mainheading">

                <!-- Author Box -->
                				
				<div class="row post-top-meta">
					<div class="col-md-2">
						<img class="author-thumb" src="/assets/images/author.jpg" alt="Pradeep Kundarapu">
					</div>
					<div class="col-md-10">
                        <a target="_blank" class="link-dark" href="http://thetechstack.net">Pradeep Kundarapu</a>
                        <a target="_blank" href="https://twitter.com/PradeepK4J" class="btn follow">Follow</a>
						<div class="author-description">Java developer, blogger and tech enthusiast.</div>						
					</div>
				</div>				
                
                
                <!-- Post Title -->
				<h1 class="posttitle">Spring Cloud Gateway - Part 2</h1> 
                
			</div>

			<!-- Post Featured Image -->
			<img class="featured-image img-fluid" src="http://thetechstack.net/assets/images/banners/spring-cloud-gateway-part-2.png" alt="Spring Cloud Gateway - Part 2">
			<!-- End Featured Image -->

			<!-- Post Content -->
			<div class="article-post">
				<p>In <strong><a href="/spring-cloud-gateway-part-1/">Part 1</a></strong> of this tutorial series, we learned to configure routes using Predicates. Predicates help us to define the conditions on the request to match the Route. In this article, we will learn about Filters.</p>

<p>Filters allow us to modify the request and response. For example, We can add a customized header to the HTTP request so all downstream services can use it. In the same way, we can add a header in the HTTP response to the client.</p>

<p>Spring Cloud Gateway comes with many Filter factories; We can configure them easily in the configuration file or customize it using <strong>RouteLocatorBuilder</strong>. In this article, we learn configuring filters but not customizing them.</p>

<p>We continue to use the same project we downloaded in <strong><a href="/spring-cloud-gateway-part-1/">Part 1</a></strong>. If you want to download it again, click on this <strong><a href="https://start.spring.io/#!type=maven-project&amp;language=java&amp;platformVersion=2.4.0.RELEASE&amp;packaging=jar&amp;jvmVersion=11&amp;groupId=com.example&amp;artifactId=demo&amp;name=demo&amp;description=Demo%20project%20for%20Spring%20Boot&amp;packageName=com.example.demo&amp;dependencies=cloud-gateway">link</a></strong>. Open it in the editor and modify application.yml with the below content.</p>

<h3 id="add-request-header-filter">Add Request Header Filter</h3>

<p>Open <strong>application.yml</strong> and add Request Header filter to the request.</p>

<figure class="highlight"><pre><code class="language-yml" data-lang="yml"><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="s">9091</span>
<span class="na">spring</span><span class="pi">:</span>
  <span class="na">cloud</span><span class="pi">:</span>
    <span class="na">gateway</span><span class="pi">:</span>
      <span class="na">routes</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s">one</span>
          <span class="na">uri</span><span class="pi">:</span> <span class="s">https://httpbin.org/</span>
          <span class="na">predicates</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">Path=/get</span>
          <span class="na">filters</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">AddRequestHeader=X-Request-AppId, 238732</span></code></pre></figure>

<ul>
  <li>Configured API gateway to use port 9091.</li>
  <li>Predicate will redirect the requests to <strong>https://httpbin.org/</strong> if the request starts with the path <strong>/get’</strong>.</li>
  <li>Filter will add a header in the HTTP request. In this case, we want to add an HTTP header with key <strong>X-Request-AppId</strong> and value as <strong>238732</strong></li>
</ul>

<p>Run the application and execute a CURL command to make a get request to ‘http://localhost:9091/get.’</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">curl http://localhost:9091/get
<span class="o">{</span>
 <span class="s2">"args"</span>: <span class="o">{}</span>, 
 <span class="s2">"headers"</span>: <span class="o">{</span>
  <span class="s2">"Accept"</span>: <span class="s2">"*/*"</span>, 
  <span class="s2">"Content-Length"</span>: <span class="s2">"0"</span>, 
  <span class="s2">"Forwarded"</span>: <span class="s2">"proto=http;host=</span><span class="se">\"</span><span class="s2">localhost:9091</span><span class="se">\"</span><span class="s2">;for=</span><span class="se">\"</span><span class="s2">0:0:0:0:0:0:0:1:58775</span><span class="se">\"</span><span class="s2">"</span>, 
  <span class="s2">"Host"</span>: <span class="s2">"httpbin.org"</span>, 
  <span class="s2">"User-Agent"</span>: <span class="s2">"curl/7.54.0"</span>, 
  <span class="s2">"X-Amzn-Trace-Id"</span>: <span class="s2">"Root=1-5fbc29e7-0f7fffaa50c1c198661a2ecf"</span>, 
  <span class="s2">"X-Forwarded-Host"</span>: <span class="s2">"localhost:9091"</span>, 
  <span class="s2">"X-Request-Appid"</span>: <span class="s2">"23452"</span>
 <span class="o">}</span>, 
 <span class="s2">"origin"</span>: <span class="s2">"0:0:0:0:0:0:0:1, XX.XX.X.XXX"</span>, 
 <span class="s2">"url"</span>: <span class="s2">"https://localhost:9091/get"</span>
<span class="o">}</span></code></pre></figure>

<p>We made a GET request on /get endpoint, and this request will match with the Path ‘/get’ which we mentioned in the Predicate, so the request directs to https://httpbin.org/, and along with that, our Filter will add a new header to the Request. HttpBin will send us back the response with all our request headers as a JSON body. We can see our Request header in the JSON response.</p>

<h3 id="rewrite-path-filter">Rewrite Path Filter</h3>

<p>Rewrite Path is one of the Filters, which is part of Spring Cloud Gateway, which I want to explain along with AddRequestHeader Filter in this article. For instance, if we want to redirect traffic to multiple different services based on the path, we can use it to direct the traffic. Following Route configuration will help you to understand how this will work.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">server:
  port: 9091
spring:
  cloud:
    gateway:
      routes:
        - <span class="nb">id</span>: one
          uri: http://localhost:8080/
          predicates:
            - <span class="nv">Path</span><span class="o">=</span>/retail/<span class="k">**</span>
          filters:
            - <span class="nv">RewritePath</span><span class="o">=</span>/retail<span class="o">(</span>?&lt;segment&gt;/?.<span class="k">*</span><span class="o">)</span>, <span class="nv">$\</span><span class="o">{</span>segment<span class="o">}</span>
        - <span class="nb">id</span>: two
            uri: http://localhost:8081/
            predicates:
              - <span class="nv">Path</span><span class="o">=</span>/banking/<span class="k">**</span>
            filters:
              - <span class="nv">RewritePath</span><span class="o">=</span>/banking<span class="o">(</span>?&lt;segment&gt;/?.<span class="k">*</span><span class="o">)</span>, <span class="nv">$\</span><span class="o">{</span>segment<span class="o">}</span></code></pre></figure>

<ul>
  <li>RewritePath will take two arguments; regular expression and replacement parameter, regular expression will contain the root context and the regExp to retrive the remaining part of the Path and this remaining part is used in the replacement parameter.</li>
  <li>HTTP calls received on <strong>http://localhost:9091/retail/orders/1</strong> will be directed to <strong>http://localhost:8080/orders/1</strong></li>
  <li>HTTP calls received on <strong>http://localhost:9091/banking/account/1</strong> will be directed to <strong>http://localhost:8081/account/1</strong></li>
</ul>

<p>This configuration is useful for directing traffic to different downstream services and grouping them under a single context path.</p>

<p>There are many other predefined filters available. We can directly use them by configuring them in the application properties file.</p>

<h3 id="conclusion">Conclusion</h3>

<p>We learned to configure routes using Filter. Filters will modify the Request and response of the HTTP call. In this article, we used an Add Header filter and Rewrite Path filter to modify HTTP headers.</p>

			</div>

            <!-- Post Date -->
            <p>
            <small>
                <span class="post-date"><time class="post-date" datetime="2020-11-30">30 Nov 2020</time></span>           
                
                </small>
            </p>
            
			<!-- Post Categories -->
			<div class="after-post-tags">
				<ul class="tags">
                    
                    
                    <li>
                     <a href="/category/java/">java</a>
                    </li>
                    
				</ul>
			</div>
			<!-- End Categories -->
            
            <!-- Prev/Next -->
            <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
            
            <a class="prev d-block col-md-6" href="http://thetechstack.net/spring-cloud-gateway-part-1/"> &laquo; Spring Cloud Gateway - Part 1</a>
            
            
            <div class="clearfix"></div>
            </div>
            <!-- End Categories -->

		</div>
		<!-- End Post -->

	</div>
</div>
<!-- End Article
================================================== -->

  

<!-- Begin Comments
================================================== -->

    <div class="container">
        <div id="comments" class="row justify-content-center mb-5">
            <div class="col-md-8">              
                
<section class="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'thetechstack-net'; 
        var disqus_developer = 0;
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = window.location.protocol + '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>
                
            </div>
        </div>
    </div>

<!--End Comments
================================================== -->
</div>

<!-- Bottom Alert Bar
================================================== -->
<div class="alertbar">
	<div class="container text-center">
		<span>Never miss any <b>article</b>, subscribe to my newsletter</span>
        <form action="https://thetechstack.us7.list-manage.com/subscribe/post?u=1381d872f022743eb338f00a1&amp;id=88d9fceb21" method="post" name="mc-embedded-subscribe-form" class="wj-contact-form validate" target="_blank" novalidate>
            <div class="mc-field-group">
            <input type="email" placeholder="Email" name="EMAIL" class="required email" id="mce-EMAIL" autocomplete="on" required>
            <input type="submit" value="Subscribe" name="subscribe" class="heart">
            </div>
        </form>
	</div>
</div>
    
</div>

<div class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
            <div class="d-md-flex align-items-center justify-content-center h-100">
                <h2 class="d-md-block align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2>
            </div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
            
          
             
              <a href="/category/java">Java (33)</a>
             
              <a href="/category/reactiveX">Reactivex (3)</a>
             
              <a href="/category/docker">Docker (2)</a>
             
              <a href="/category/tools">Tools (1)</a>
             
              <a href="/category/spring">Spring (2)</a>
             
              <a href="/category/kotlin">Kotlin (12)</a>
             
              <a href="/category/cloud">Cloud (1)</a>
            
          
        

		</div>
	</div>
</div>
 


<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                 Copyright © 2020 The Tech Stack . Net 
            </div>
            <!--<div class="col-md-6 col-sm-6 text-center text-lg-right">    
                <a target="_blank" href="https://www.wowthemes.net">Mediumish Theme</a> by WowThemes.net
            </div>-->
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

   
</div> 
<!-- Placed at the end of the document so the pages load faster -->
    
<script src="/assets/js/jquery.min.js"></script>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    
<script src="/assets/js/ie10-viewport-bug-workaround.js"></script>
    
<script src="/assets/js/mediumish.js"></script>
    
<script id="dsq-count-scr" src="//thetechstack-net.disqus.com/count.js"></script>
</body>
</html>
